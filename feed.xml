<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.1.1">Jekyll</generator><link href="https://classmech.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://classmech.github.io/" rel="alternate" type="text/html" hreflang="en" /><updated>2025-08-18T07:24:38-05:00</updated><id>https://classmech.github.io/feed.xml</id><title type="html">ClassMech</title><subtitle></subtitle><entry><title type="html">Модель стандартной атмосферы для среды динамического моделирования SimInTech</title><link href="https://classmech.github.io/blog/cae/2025-08-17-simintec-standard-atmosphere/" rel="alternate" type="text/html" title="Модель стандартной атмосферы для среды динамического моделирования SimInTech" /><published>2025-08-17T00:00:00-05:00</published><updated>2025-08-17T00:00:00-05:00</updated><id>https://classmech.github.io/blog/cae/simintec-standard-atmosphere</id><content type="html" xml:base="https://classmech.github.io/blog/cae/2025-08-17-simintec-standard-atmosphere/"><![CDATA[<p>Модель стандартной атмосферы по ГОСТ 4401-81 для среды динамического моделирования “SimInTech” для диапазона геометрической высоты от -2 до 400 км. В отличие от стандартного блока “Параметры стандартной атмосферы (ГОСТ 4401-81)” библиотеки “Динамика ЛА” представленная здесь модель (блок) может использоваться для определения плотности воздуха, скорости звука, температуры и давления для высоты от -2 до 400 км. Стандартный блок корректно определяет параметры атмосферы до 80 км.</p>

<p><a href="https://gitverse.ru/classmech/gost_4401-81_simintech">Репозитарий проекта на gitverse</a>.</p>]]></content><author><name></name></author><category term="cae" /><category term="simintech" /><summary type="html"><![CDATA[Модель стандартной атмосферы по ГОСТ 4401-81 для среды динамического моделирования "SimInTech" для диапазона геометрической высоты от -2 до 400 км]]></summary></entry><entry><title type="html">Модель эффекта Джанибекова в Wolfram Mathematica</title><link href="https://classmech.github.io/blog/mechanics/2025-04-23-janibekov-effect-in-wolfram-mathematica/" rel="alternate" type="text/html" title="Модель эффекта Джанибекова в Wolfram Mathematica" /><published>2025-04-23T00:00:00-05:00</published><updated>2025-04-23T00:00:00-05:00</updated><id>https://classmech.github.io/blog/mechanics/janibekov-effect-in-wolfram-mathematica</id><content type="html" xml:base="https://classmech.github.io/blog/mechanics/2025-04-23-janibekov-effect-in-wolfram-mathematica/"><![CDATA[<ul>
  <li><a href="/assets/files/Mathematica/Janibekov-effect.nb">Файл Wolfram Mathematica</a></li>
  <li><a href="/assets/files/3d/screw.stl">3D-модель гайки-барашка (stl)</a></li>
</ul>

<p><img src="/assets/files/Mathematica/Janibekov-effect.gif" alt="" /></p>

<p>Динамические уравнения Эйлера</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">eq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nv">Jx</span><span class="w"> </span><span class="nv">wx</span><span class="o">'</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="nv">Jy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Jz</span><span class="p">)</span><span class="w"> </span><span class="nv">wy</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nv">wz</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="o">,</span><span class="w">
   </span><span class="nv">Jy</span><span class="w"> </span><span class="nv">wy</span><span class="o">'</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="nv">Jz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Jx</span><span class="p">)</span><span class="w"> </span><span class="nv">wx</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nv">wz</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="o">,</span><span class="w">
   </span><span class="nv">Jz</span><span class="w"> </span><span class="nv">wz</span><span class="o">'</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="nv">Jx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">Jy</span><span class="p">)</span><span class="w"> </span><span class="nv">wy</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nv">wx</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w">
   </span><span class="p">}</span><span class="o">;</span><span class="w">
</span></code></pre></div></div>

<p>Кинематические уравнения для углов последовательности XZ’X’’</p>

<div class="language-mathematica highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="nv">kinematicEq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="err">ψ</span><span class="o">'</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="nv">wz</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nb">Sin</span><span class="p">[</span><span class="err">φ</span><span class="p">[</span><span class="nv">t</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">wy</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nb">Cos</span><span class="p">[</span><span class="nv">\[CurlyPhi]</span><span class="p">[</span><span class="nv">t</span><span class="p">]])</span><span class="o">/</span><span class="w">
     </span><span class="nb">Sin</span><span class="p">[</span><span class="nv">\[CurlyTheta]</span><span class="p">[</span><span class="nv">t</span><span class="p">]]</span><span class="o">,</span><span class="w">
   </span><span class="nv">\[CurlyTheta]</span><span class="o">'</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> 
    </span><span class="nv">wz</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nb">Cos</span><span class="p">[</span><span class="nv">\[CurlyPhi]</span><span class="p">[</span><span class="nv">t</span><span class="p">]]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">wy</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nb">Sin</span><span class="p">[</span><span class="nv">\[CurlyPhi]</span><span class="p">[</span><span class="nv">t</span><span class="p">]]</span><span class="o">,</span><span class="w">
   </span><span class="nv">\[CurlyPhi]</span><span class="o">'</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> 
    </span><span class="nv">wx</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nv">wy</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nb">Cos</span><span class="p">[</span><span class="nv">\[CurlyPhi]</span><span class="p">[</span><span class="nv">t</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">wz</span><span class="p">[</span><span class="nv">t</span><span class="p">]</span><span class="w"> </span><span class="nb">Sin</span><span class="p">[</span><span class="nv">\[CurlyPhi]</span><span class="p">[</span><span class="nv">t</span><span class="p">]])</span><span class="o">/</span><span class="w">
      </span><span class="nb">Tan</span><span class="p">[</span><span class="nv">\[CurlyTheta]</span><span class="p">[</span><span class="nv">t</span><span class="p">]]</span><span class="w">
   </span><span class="p">}</span><span class="o">;</span><span class="w">
</span></code></pre></div></div>]]></content><author><name></name></author><category term="mechanics" /><category term="mathematica" /><summary type="html"><![CDATA[Численное интегрирование уравнений пространственного движения твёрдого тела вокруг неподвижной точки и его визуализация в Wolfram Mathematica]]></summary></entry><entry><title type="html">Моделирования движения механизма с двумя степенями свободы</title><link href="https://classmech.github.io/blog/mechanics/cae/2024-11-09-simintech-course-work/" rel="alternate" type="text/html" title="Моделирования движения механизма с двумя степенями свободы" /><published>2024-11-09T00:00:00-06:00</published><updated>2024-11-09T00:00:00-06:00</updated><id>https://classmech.github.io/blog/mechanics/cae/simintech-course-work</id><content type="html" xml:base="https://classmech.github.io/blog/mechanics/cae/2024-11-09-simintech-course-work/"><![CDATA[<p><a href="https://gitverse.ru/classmech/simintech/content/master/Курсовая_ТМ">Пример модели механизма с двумя степенями свободы</a> из заданий для курсовой работы кафедры теоретической механики Самарского университета.</p>]]></content><author><name></name></author><category term="mechanics" /><category term="CAE" /><category term="simintech" /><summary type="html"><![CDATA[SimInTech-проект моделирования движения механизма с двумя степенями свободы]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://classmech.github.io/assets/img/blog/simintech-course-work.png" /><media:content medium="image" url="https://classmech.github.io/assets/img/blog/simintech-course-work.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Модель движения маятника с точкой подвеса на колесе</title><link href="https://classmech.github.io/blog/mechanics/cae/2024-10-24-wheel-pendulum/" rel="alternate" type="text/html" title="Модель движения маятника с точкой подвеса на колесе" /><published>2024-10-24T00:00:00-05:00</published><updated>2024-10-24T00:00:00-05:00</updated><id>https://classmech.github.io/blog/mechanics/cae/wheel-pendulum</id><content type="html" xml:base="https://classmech.github.io/blog/mechanics/cae/2024-10-24-wheel-pendulum/"><![CDATA[<p>Рассмотрим движение физического маятника с точкой подвеса шарнирно закрепленной в центре колеса (точка С). Колесо может катиться без проскальзывания  по прямой линии на горизонтальной плоскости.</p>

<p>Эта механическая система имеет две степени свободы: её положение определяется углом поворота колеса \(\varphi\) и углом отклонения маятника от вертикали – \(\beta\). Координата центра масс колеса относительно неподвижной системы координат Oxy, расположенной на плоскости, будет определяться произведением радиуса колеса \(r\) на угол его поворота \(\varphi\) с противоположным знаком (рисунок 1).</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/mech.svg" alt="" /></p>

<p class="figcaption">Рисунок 1 - Схема механизма</p>

<p>Движение механизма описывается следующей системой дифференциальных уравнений второго порядка:</p>

\[\left\{
\begin{aligned}
    &amp; \dot \omega a_{11} + \ddot \beta a_{12} \cos \beta  = a_{12} \dot{\beta}^2 \sin \beta - L \\
    &amp; \dot \omega a_{12} \cos \beta + \ddot{\beta} a_{22} = L + m g b \sin \beta \\
\end{aligned}
\right.\]

<p>где \(a_{11} = m_1 r^2+J_1\), \(a_{12} = m_2 r l\), \(a_{22} = J_2\), \(m_1\,J_1\) – масса и момент инерции колеса относительно его центра C, \(r\) – радиус колеса, \(m_2,\,J_2\) – масса и момент инерции маятника относительно точки закрепления С, \(L\) – момент привода, который стремится повернуть маятник против часовой стрелки, а колесо в противоположном направлении.</p>

<p class="note" title="Источник">Уравнения движения маятника приведены в монографии: Формальский А. М. Управление движением неустойчивых объектов.  М.: Физматлит, 2012.</p>

<h2 id="модель-simintech">Модель SimInTech</h2>

<h3 id="параметры-модели-глобальные-переменные">Параметры модели (глобальные переменные)</h3>

<p>Создадим новый проект “Файл”→”Новый проект”→”Схема модели общего вида”.</p>

<p>Параметры (константы) механической системы зададим в <a href="https://help.simintech.ru/#6_interfejs_programmy/skhemnoe_okno/panel_knopok_bystrogo_dostupa/sloi/DAT_knopka_skript.html">скрипте проекта</a>. Для открытия скрипта проекта необходимо нажать на кнопку “Скрипт” на панели инструментов окна проекта (рисунок 2).</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/toolbar.png" alt="" /></p>

<p class="figcaption">Рисунок 2 - Панель инструментов проекта</p>

<p>В редакторе кода (скрипта проекта) создадим секцию инициализации и определим значения параметров механической системы. Секция инициализации выполнятся один раз при запуске проекта:</p>

<div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">initialization</span>
	<span class="c1">// Радиус колеса
</span>	<span class="n">r</span> <span class="p">=</span> <span class="m">0.25</span><span class="p">;</span>
	<span class="c1">// Длина стержня
</span>	<span class="n">l</span> <span class="p">=</span> <span class="m">1.0</span><span class="p">;</span>
	<span class="c1">// Масса колеса
</span>	<span class="n">m1</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
	<span class="c1">// Масса груза		
</span>	<span class="n">m2</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
	<span class="c1">// Момент инерции колеса
</span>	<span class="n">J1</span> <span class="p">=</span> <span class="m">0.5</span><span class="p">*</span><span class="n">m1</span><span class="p">*</span><span class="n">r</span><span class="p">^</span><span class="m">2</span><span class="p">;</span>
	<span class="c1">// Момент инерции груза относительно оси вращения
</span>	<span class="n">J2</span> <span class="p">=</span> <span class="n">m2</span><span class="p">*</span><span class="n">l</span><span class="p">^</span><span class="m">2</span><span class="p">;</span>	
	<span class="c1">// Ускорение силы тяжести
</span>	<span class="n">g</span> <span class="p">=</span> <span class="m">9.81</span><span class="p">;</span>
	<span class="c1">// Начальный угол поворота
</span>	<span class="n">beta0</span> <span class="p">=</span> <span class="m">0.7</span><span class="p">;</span>	            	
<span class="k">end</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="модель-механизма">Модель механизма</h3>

<p>Модель механизма построим при помощи блока <a href="https://help.simintech.ru/index_frames.html?q=/10_biblioteki_blokov/avtomatika/Dinamicheskie/DAT_0985.html">“Язык программирования”</a> из библиотеки <a href="https://help.simintech.ru/index_frames.html?q=/10_biblioteki_blokov/avtomatika/DIR_dinamicheskie.html">“Динамические”</a>. После помещения блока на схему проекта необходимо дважды начать левую кнопку мыши, чтобы открылся редактор кода блока. В блоке при помощи директивы input объявлены входные переменные: угол поворота маятника от вертикали (beta), угловая скорость вращения маятника (dbeta), угол поворота колеса (phi), угловая скорость колеса (w) и момент привода (Torque). Выходные переменные блока (output) – это угловое ускорением маятника (d2beta) и угловое ускорение колеса (dw):</p>

<div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">input</span> 	<span class="n">beta</span><span class="p">,</span> <span class="n">dbeta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Torque</span><span class="p">;</span>
<span class="n">output</span>  <span class="n">d2beta</span><span class="p">,</span><span class="n">dw</span><span class="p">;</span>                 
</code></pre></div></div>

<p>В блоке формируется матрица коэффициентов при старших производных системы дифференциальных уравнений движения механизма (матрица масс), матрица правых частей, производится решение системы линейный уравнений относительной старших производных при помощи функции <a href="https://help.simintech.ru/index_frames.html?q=/11_yazyk_programmirovaniya/6_funkcii/1_vektornye_i_matrichnye/lsolve.html">lsolve</a>:</p>

<div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Коэффициенты матрицы масс
</span><span class="n">a11</span> <span class="p">=</span> <span class="n">m1</span><span class="p">*(</span><span class="n">r</span><span class="p">*</span><span class="n">r</span><span class="p">+</span><span class="n">rho</span><span class="p">*</span><span class="n">rho</span><span class="p">)+</span><span class="n">m2</span><span class="p">*</span><span class="n">r</span><span class="p">*</span><span class="n">r</span><span class="p">;</span>
<span class="n">a12</span> <span class="p">=</span> <span class="n">m2</span><span class="p">*</span><span class="n">r</span><span class="p">*</span><span class="n">l</span><span class="p">;</span>
<span class="n">a21</span> <span class="p">=</span> <span class="n">a12</span><span class="p">;</span>
<span class="n">a22</span> <span class="p">=</span> <span class="n">m2</span><span class="p">*</span><span class="n">r</span><span class="p">*</span><span class="n">r</span><span class="p">;</span>                   
<span class="c1">// Коэффициенты столбца правой части
</span><span class="n">b1</span>  <span class="p">=</span> <span class="p">-</span><span class="n">Torque</span><span class="p">+</span><span class="n">a12</span><span class="p">*</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">)*</span><span class="n">dbeta</span><span class="p">^</span><span class="m">2</span><span class="p">;</span>
<span class="n">b2</span>  <span class="p">=</span> <span class="p">+</span><span class="n">Torque</span><span class="p">+</span><span class="n">m2</span><span class="p">*</span><span class="n">g</span><span class="p">*</span><span class="n">l</span><span class="p">*</span><span class="n">sin</span><span class="p">(</span><span class="n">beta</span><span class="p">);</span>
<span class="c1">// Матрица масс 
</span><span class="n">A</span> <span class="p">=</span> <span class="p">[[</span><span class="n">a12</span><span class="p">*</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="n">a11</span><span class="p">],[</span><span class="n">a22</span><span class="p">,</span><span class="n">a12</span><span class="p">*</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)]];</span>
<span class="c1">// Матрица правой части
</span><span class="n">B</span> <span class="p">=</span> <span class="p">[</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">];</span>
<span class="c1">// Ускорения
</span><span class="n">da</span> <span class="p">=</span> <span class="n">lsolve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">);</span>
<span class="c1">// Ускорения записываем в переменные, объявленные в секции output
</span><span class="n">d2beta</span> <span class="p">=</span> <span class="n">da</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
<span class="n">dw</span>     <span class="p">=</span> <span class="n">da</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
</code></pre></div></div>

<p>Таким образом, при помощи блока <a href="https://help.simintech.ru/index_frames.html?q=/10_biblioteki_blokov/avtomatika/Dinamicheskie/DAT_0985.html">“Язык программирования”</a> построена функция, описывающая правую часть системы дифференциальных уравнений движения механизма в форме Коши: на вход блока подаются углы и угловые скорости, на выходе формируются угловые ускорения колеса и маятника:</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/mechanism.png" alt="" /></p>

<p class="figcaption">Рисунок 3 - Функция правых частей системы дифференциальных уравнений механизма</p>

<h3 id="интегрирование">Интегрирование</h3>

<p>Сигналы с выходов блока <a href="https://help.simintech.ru/index_frames.html?q=/10_biblioteki_blokov/avtomatika/Dinamicheskie/DAT_0985.html">“Язык программирования”</a> подадим на <a href="https://help.simintech.ru/index_frames.html?q=/10_biblioteki_blokov/avtomatika/Dinamicheskie/DAT_0027.html">блоки-интеграторы</a>, на выходах которых в результате интегрирования формируются угловая скорость, угол поворота маятника, угловая скорость и угол поворота колеса.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/integrators.png" alt="" /></p>

<p class="figcaption">Рисунок 4 - Интегрирование сигналов с выходов блока “Язык программирования”</p>

<p>Сигналы с выходов интеграторов записываются в память (блоки <a href="https://help.simintech.ru/index_frames.html?q=/10_biblioteki_blokov/avtomatika/Substruktury/1008.html">“В память”</a> библиотеки “Субструктуры”) для того чтобы не загромождать схему системы пересекающимися соединительными линиями. Блок <a href="https://help.simintech.ru/index_frames.html?q=/10_biblioteki_blokov/avtomatika/Substruktury/1008.html">“В память”</a> предназначен для соединения одной части схемы с другой, находящейся в произвольном месте проекта. Установка блока на линию связи соответствует установке именованной метки на блок-схеме. После чего, помеченный сигнал может быть использован в произвольном месте проекта с помощью блока <a href="https://help.simintech.ru/index_frames.html?q=/10_biblioteki_blokov/avtomatika/Substruktury/1009.html">“Из памяти”</a>.</p>

<p>В свойствах второго интегратора на выходе d2beta зададим начальный угол поворота маятника beta0, объявленный в скрипте инициализации проекта (рисунок 5).</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/integrators2.png" alt="" /></p>

<p class="figcaption">Рисунок 5 - Начальные условия интегрирования (свойства блока-интегратора)</p>

<p>В параметрах остальных блоков-интеграторов в качестве начальных условий указаны нули (это значения “по-умолчанию”), т.е. в начальный момент времени маятник отклонён на угол beta0, при этом угол  поворота колеса, его угловая скорость и угловая скорость самого мятника равны нулю .</p>

<p>Схема модели свободного движения маятника при нулевом внешнем моменте имеет показана на рисунке 6. На вход “torque” модели дифференциальных уравнений подан постоянный нулевой сигнал.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/mechanism2.png" alt="" /></p>

<p class="figcaption">Рисунок 6 - Модель механизма</p>

<h3 id="сигналы-проекта">Сигналы проекта</h3>

<h4 id="создание-сигналов">Создание сигналов</h4>

<p>При помощи <a href="https://help.simintech.ru/index_frames.html?q=/13_priemy_raboty/1_modelirovanie/signaly_proekta_baza_signalov_vektorizovannyi_blok.html">редактора сигналов проекта</a> (Главное меню → Сервис → Сигналы) создадим четыре глобальные переменные, в которые будем записывать кинематические параметры маятника: углы поворота и угловые скорости колеса и маятника. Эти сигналы нам понадобятся для построения графиков кинематических параметров механизма и для визуализации его движения.</p>

<p class="note" title="Сигналы">Под <a href="https://help.simintech.ru/#13_priemy_raboty/1_modelirovanie/signaly_proekta_baza_signalov_vektorizovannyi_blok.html">сигналами в SimInTech понимаются</a> глобальные параметры проекта или группы проектов, которые создаются тремя способами: при помощи таблицы сигналов проекта, путем объявления и задания сигналов в скрипте проекта с помощью внутреннего языка программирования или с помощью базы данных проекта, если необходим обмен данными между несколькими проектами в рамках пакета проектов.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/signals.png" alt="" /></p>

<p class="figcaption">Рисунок 7 - Сигналы проекта</p>

<h4 id="связь-сигналов-с-динамическими-переменными-блоков-модели">Связь сигналов с динамическими переменными блоков модели</h4>

<p>После создания списка сигналов откроем <a href="https://help.simintech.ru/index_frames.html?q=/13_priemy_raboty/1_modelirovanie/signaly_proekta_baza_signalov_vektorizovannyi_blok.html">редактор связей</a> (Главное меню → Сервис → Связи…), при помощи которого установим связь между кинематическими параметрами и созданными ранее глобальными переменными – сигналами проекта.</p>

<p>После открытия редактора связей, не закрывая его, в окне модели выделим второй блок интегратор (рисунок 8), на вход которого поступает производная угла поворота маятника \(\dot beta\), а на выходе формируется угол \(\beta\). В левой нижней области списка сигналов блока “Интегратор” появятся переменная  fdif, обозначающая то, то поступает на вход блока (первая производная угла \(\dot \beta\)), и xdiff – то, что формируется на выходе блока – результат интегрирования (\(\beta\)). Левой кнопкой мыши схватим строчку xdiff и перетащим её в свободную строчку столбца “Источник”.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/connection1.png" alt="" /></p>

<p class="figcaption">Рисунок 8 - Связь сигналов с параметрами блока (выбор блока)</p>

<p>Далее откроем вкладку “Сигнал” редактора связей. Здесь будет показан список ранее созданных сигналов проекта. Левой кнопкой мыши схватим строку beta и перетащим её в столбец “Приёмник”, как показано на рисунке 9. Таким образом мы указали, что результат интегрирования блока “Integrator_2” будет в процессе моделирования автоматически записываться в глобальную переменную (“сигнал проекта”) beta. Подобным образом необходимо связать все оставшиеся сигналы проекта.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/connection2.png" alt="" /></p>

<p class="figcaption">Рисунок 9 - Связь сигналов с параметрами блока (выбор сигнала)</p>

<h3 id="графики-сигналов">Графики сигналов</h3>

<p>Для построения графиков изменения угла поворота маятника \(\beta\) откроем <a href="https://help.simintech.ru/index_frames.html?q=/21_postroenie_grafikov_i_vyvod_raschetnyx_dannyx/grafiki/DAT_kak_sozdat_grafik.html">менеджер данных</a> (рисунок 10) и, нажав правую кнопку мыши, добавим в раздел “Графики” новый “Временной график”.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/manager.png" alt="" /></p>

<p class="figcaption">Рисунок 10 - Менеджер данных</p>

<p>В контекстном меню созданного временного графика, выберем “Добавить” и “Параметр”, указав в качестве имени параметра сигнал проекта  beta.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/graph-parameter.png" alt="" /></p>

<p class="figcaption">Рисунок 11 - Добавить параметр</p>

<p>Аналогичным образом создадим временные графики для всех определенных ранее сигналов проекта, связанных с параметрами модели.</p>

<h3 id="результаты-моделирования">Результаты моделирования</h3>

<p>На рисунке 12 показано изменение угла поворота маятника при его свободном движении после запуска процесса моделирования движения механизма. Как следует из рисунка 12, в своём свободном движении при заданных начальных условиях маятник совершает колебаний вокруг устойчивого положения равновесия \(\beta = \pi\).</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/fig-beta.png" alt="" /></p>

<p class="figcaption">Рисунок 12 - Угол поворота маятника</p>

<h3 id="система-управления">Система управления</h3>

<h4 id="управление-углом-beta">Управление углом \(\beta\)</h4>

<p>Добавим в модель системы управления, которая будет удерживать маятник в неустойчивом положении равновесия \(\beta = 0\). Сигнал момента, формируемого системой управления, определим как линейную комбинацию угла \(\beta\) и его производной:</p>

\[M_\beta = - k_1 [(\beta-\beta_p) + k_2 (\dot{\beta}-\dot{\beta}_p)]\]

<p>Т.е. управляющий момент \(M_\beta\)  будет тем больше по модулю, чем больше отклонение (ошибка) угла и угловой скорости от требуемого (программного) значения \(\beta_p = 0\), \(\dot{\beta}_p = 0\). Знак минус в выражении момента означает, что знак момента будет противоположен знаку отклонения угла \(\beta\) от вертикального положения и знаку отклонения угловой скорости от нуля. Коэффициенты \(k_1\) и \(k_2\) – коэффициенты усиления отклонений. Выбор этих параметров – это отдельная задача теории автоматического управления, которая здесь не рассматривается.</p>

<p>На рисунке 13 приведен график изменения угла поворота маятника при действии определенного выше момента \(M_\beta\) c \(k_1 = 60\) Нм/рад и \(k_2 = 9\) Нм*с/рад: при этих коэффициентах в течение 2 секунд мятник возвращается и удерживается системой управления в нулевом положении.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/fig-beta2.png" alt="" /></p>

<p class="figcaption">Рисунок 13 - Угол поворота маятника при управлении</p>

<h4 id="управление-углом-varphi">Управление углом \(\varphi\)</h4>

<p>При действии управляющего момента \(M_\beta\) движение самого колеса не контролируется, поэтому после стабилизации углового положения маятника колесо продолжит движение с некоторой скоростью. Это иллюстрирует рисунок 14, где показан график изменения угловой скорости колеса.</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/fig-w.png" alt="" /></p>

<p class="figcaption">Рисунок 14 - Угловая скорость вращения колеса</p>

<p>Добавим управление, которое будет возвращать колесо в начало координат. Для этого к управляющему моменту \(M_\beta\) добавим еще один момент, значение которого будет пропорционально отклонению угла поворота колеса \(\varphi\)  и его угловой скорости \(\omega = \dot{\varphi}\) от нулевого значения. Поскольку колесо катится без проскальзывания, нулевое значение угла \(\varphi\) будет соответствовать его положению  \(x = - r \varphi\) в начале координат (рисунок 1):</p>

\[M_\varphi = - [k_3 (\varphi-\varphi_p) + k_4 (\dot{\varphi}-\dot{\varphi}_p)]\]

<p>где \(\varphi_p = \dot{\varphi}_p = 0\) – программные значения угла поворота и угловой скорости колеса.</p>

<p>Схема модели будет иметь вид:</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/wheel-model.png" alt="" /></p>

<p class="figcaption">Рисунок 15 - Схема модели</p>

<p>На рисунках 16 и 17 показаны графики изменения угла поворота маятника и угловой скорости колеса при действии управляющего момента</p>

\[M_u = M_\beta + M_\varphi.\]

<p><img src="/assets/img/blog/simintech-pendulum-wheel/fig-beta3.png" alt="" /></p>

<p class="figcaption">Рисунок 16 - Изменение угла поворота маятника</p>

<p><img src="/assets/img/blog/simintech-pendulum-wheel/fig-w3.png" alt="" /></p>

<p class="figcaption">Рисунок 17 - Изменение угловой скорости колеса</p>

<p>Работа управляющего момента показана на следующем видео:</p>

<iframe width="720" height="405" src="https://rutube.ru/play/embed/372d6fbe0938d1a08b05ff77c2aa9085/?p=GIjg2NRaHxzazvODRIn6Yw" frameborder="0" allow="clipboard-write; autoplay" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>

<p><a href="https://gitverse.ru/classmech/simintech/content/master/pendulum_wheel">Проект на GitVerse.</a></p>]]></content><author><name></name></author><category term="mechanics" /><category term="CAE" /><category term="simintech" /><summary type="html"><![CDATA[Построение в среде динамического моделирования SimInTech модели движения маятника с подвижной точкой подвеса, закрепленной на колесе.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://classmech.github.io/assets/img/blog/simintech-pendulum-wheel/slide.jpg" /><media:content medium="image" url="https://classmech.github.io/assets/img/blog/simintech-pendulum-wheel/slide.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Пример вывода уравнений движения системы тел методом Кейна</title><link href="https://classmech.github.io/blog/mechanics/cae/matlab/2024-08-15-kane-3d/" rel="alternate" type="text/html" title="Пример вывода уравнений движения системы тел методом Кейна" /><published>2024-08-15T00:00:00-05:00</published><updated>2024-08-15T00:00:00-05:00</updated><id>https://classmech.github.io/blog/mechanics/cae/matlab/kane-3d</id><content type="html" xml:base="https://classmech.github.io/blog/mechanics/cae/matlab/2024-08-15-kane-3d/"><![CDATA[<h1 id="метод-кейна">Метод Кейна</h1>

<p>Метод разработан в 1961 проф. Т. Кейном (Стэндфорский университет) (Kane, T.R., Dynamics of nonholonomic systems, J. App. Mech., 28, 574, 1961). Метод основан на принципе Даламбера-Лагранжа и ориентирован на машинное формирование уравнений движения. При выводе уравнений движения используются вспомогательные векторные величины, которые здесь будут называться частными линейными \(\mathbf v_{ik}\) и угловыми скоростями \(\boldsymbol \omega_{ik}\). Эти величины являются векторными множителями, стоящими перед обобщенными скоростями в выражениях для линейных и угловых скоростей тел механической системы. Например, скорость материальной точки на плоскости, положение которой определяется двумя координатами x и y, в декартовой системе координат можно представить как:</p>

\[\mathbf v = \mathbf{e}_x \dot{x} + \mathbf{e}_y \dot{y}\]

<p>В этом выражении частными линейными скоростями будут единичные векторы \(\mathbf{e}_x\) и \(\mathbf{e}_x\).</p>

<p>При вращении твердого тела вокруг неподвижной точки частными угловыми скоростями будет орты связанной с телом системы координат \(\mathbf{e}_x^c, \mathbf{e}_y^c, \mathbf{e}_z^c\), поскольку угловая скорость тела будет определяться выражением</p>

\[\boldsymbol{\omega} = \mathbf{e}_x^c \omega_x + \mathbf{e}_y^c \omega_y + \mathbf{e}_z^c \omega_z\]

<p>Рассмотрим движение несвободной системы материальных точек. Движение каждой точки определяется внешней силой и силой реакции:</p>

\[m_k \mathbf a_k = \mathbf F_k + \mathbf R_k, \quad k=1,\ldots,n.\]

<p>После умножения каждого уравнения на соответствующее виртуальное перемещение \(\delta \mathbf r_k\) и сложения всех уравнений, для идеальных связей получим общее уравнение динамики:</p>

\[\sum_{k=1}^N \left(\mathbf F_k - m_k \mathbf a_k \right)\cdot \delta \mathbf r_k + \sum_{k=1}^N \underbrace{\mathbf R_k \cdot \delta \mathbf r_k}_{0} = 0.\]

<p>Подставляя вариации радиус-вектора \(\mathbf r_k(q_1,\ldots,q_n)\) в обобщённых координатах:</p>

\[\delta \mathbf r_k =  \sum_{i=1}^n \frac{\partial \mathbf r_k}{\partial q_i} \delta q_i.\]

<p>получим</p>

\[\sum_{k=1}^N \left(\mathbf F_k - m_k \mathbf a_k \right)\cdot \sum_{i=1}^n \frac{\partial \mathbf r_k}{\partial q_i} \delta q_i  = 0.\]

<p>После изменения порядка суммирования:</p>

\[\sum_{i=1}^n \sum_{k=1}^N \left(\mathbf F_k \cdot \frac{\partial \mathbf r_k}{\partial q_i} - m_k \mathbf a_k \cdot \frac{\partial \mathbf r_k}{\partial q_i} \right) \delta q_i = 0.\]

<p>и с учётом независимости вариаций обобщённых координат:</p>

\[\sum_{k=1}^N \left(\mathbf F_k \cdot \frac{\partial \mathbf r_k}{\partial q_i} - m_k \mathbf a_k \cdot \frac{\partial \mathbf r_k}{\partial q_i} \right)= 0, \quad i=1,\ldots,n.\]

<p>Частная производная вектора скорости точки по обобщенной скорости имеет вид:</p>

\[\frac{\partial \mathbf v_k}{\partial \dot q_i} = \frac{\partial {\mathbf r_k}}{\partial {q}_i} = \mathbf u_{ki}.\]

<p>и называется частной скоростью:</p>

\[\mathbf u_{ki} = \frac{\partial \mathbf v_k}{\partial \dot q_i}\]

<p>Подставляя</p>

\[\frac{\partial {\mathbf r_k}}{\partial {q}_j} = \frac{\partial \mathbf v_k}{\partial \dot q_j}\]

<p>в уравнения движения</p>

\[\sum_{k=1}^N \left(\mathbf F_k \cdot \frac{\partial \mathbf r_k}{\partial q_i} - m_k \mathbf a_k \cdot \frac{\partial \mathbf r_k}{\partial q_i} \right)= 0, \quad i=1,\ldots,n.\]

<p>получим</p>

\[\sum_{k=1}^N \left(\mathbf F_k \cdot \frac{\partial \mathbf v_k}{\partial \dot q_i} - m_k \mathbf a_k \cdot \frac{\partial \mathbf v_k}{\partial \dot q_i} \right)= 0, \quad i=1,\ldots,n.\]

<p>или</p>

\[\sum_{k=1}^N \left(\mathbf F_k \cdot \mathbf u_{ki} - m_k \mathbf a_k \cdot \mathbf u_{ki} \right)= 0, \quad i=1,\ldots,n.\]

<p>Обозначив обобщенные активные силы \(Q_i\) и силы инерции \(Q_i^*\):</p>

\[Q_i = \sum_{k=1}^{N} \mathbf F_k \cdot \mathbf u_{ki}, \quad
  Q_i^* = - \sum_{k=1}^{N} m_k \mathbf a_k \cdot \mathbf u_{ki}\]

<p>уравнения</p>

\[\sum_{k=1}^N \left(\mathbf F_k \cdot \mathbf u_{ki} - m_k \mathbf a_k \cdot \mathbf u_{ki} \right)= 0, \quad i=1,\ldots,n.\]

<p>принимают вид:</p>

\[Q_i + Q_i^* = 0.\]

<h3 id="алгоритм">Алгоритм</h3>

<ol>
  <li>Выбираются обобщенные координаты \(q_1,q_2\ldots,q_n\).</li>
  <li>Определяются скорости тел, которые  могут быть как производные обобщенных координат, так и их линейными комбинациями (например, угловые скорости для твердого тела).</li>
  <li>Определяются выражения для векторов скоростей точек приложения сил.</li>
  <li>Определяются выражения для векторов скоростей центров масс тел.</li>
  <li>Определяются выражения для векторов угловых скоростей тел.</li>
  <li>Определяются векторы линейных ускорений тел системы и их угловые ускорения.</li>
  <li>Определяются частные линейные и угловые скорости для точек приложения сил, центров масс тел.</li>
  <li>Определяются силы и моменты (активные и инерционные).</li>
  <li>Вычисляются скалярные произведения сил, моментов и частных скоростей.</li>
</ol>

<h1 id="пример">Пример</h1>

<h2 id="схема-системы">Схема системы</h2>

<p>Используя метод Кейна, построим модель движения механической системы с четырьмя степенями свободы, представленной на рисунке 1. Система состоит из двух стержней связанных шарнирами. Первый стержень при помощи сферического шарнира связан с неподвижным основанием, второй стержень соединяется с первым при помощи цилиндрического шарнира.</p>

<p>Движение механизма происходит под действием силы тяжести, действующей отрицательном направлении оси \(Oz_0\).</p>

<p><img src="/assets/img/blog/kane-two-bodies-model.png" alt="" /></p>

<p class="figcaption">Рисунок 1 - Схема механизма</p>

<p>Положение шарниров задано координатными столбцами векторов \(\mathbf{c}_{11}^{(1)}\), \(\mathbf{c}_{12}^{(1)}\), \(\mathbf{c}_{22}^{(2)}\):</p>

<ul>
  <li>вектор \(\mathbf{c}_{11}\) соединяет центр масс тела 1 и шарнирную точку (О) первого шарнира;</li>
  <li>вектор \(\mathbf{c}_{12}\) соединяет центр масс тела 1 и шарнирную точку (А) второго шарнира;</li>
  <li>вектор \(\mathbf{c}_{22}\) соединяет центр масс тела 2 и шарнирную точку (А) второго шарнира.</li>
</ul>

<h2 id="кинематические-соотношения">Кинематические соотношения</h2>

<p>Положение системы определим столбцом обобщенных координат:</p>

\[\mathbf q = [\alpha_1,\alpha_2,\alpha_3,\alpha_4]^T\]

<p>Первые три угла определяют ориентацию базиса \(C_1 x_1 y_1 z_1\), связанного с телом 1 относительно неподвижного базиса \(O x_0 y_0 z_0\). Для определения ориентации используется последовательность XY’Z’’ (углы Брайнта). Матрица преобразования координат из базиса \(C_1 x_1 y_1 z_1\) в базис \(O x_0 y_0 z_0\) определяется выражением:</p>

\[\mathbf{A}^{01} = \mathbf{A}_{x}(\alpha_1) \mathbf{A}_{y}(\alpha_2) \mathbf{A}_{z}(\alpha_3)\]

<p>Угол \(\alpha_4\) определяет ориентацию тела 2 относительно тела 1. Вращение тела 2 относительно тела 1 происходит вокруг общей оси \(y\), поэтому матрица преобразования координат из базиса \(C_2 x_2 y_2 z_2\), связанного со вторым телом в базис \(C_1 x_1 y_1 z_1\), будет иметь вид:</p>

\[\mathbf{A}^{12} = \mathbf{A}_{y}(\alpha_4)\]

<p>Сформируем столбец скоростей системы, но не из обобщенных скоростей, а из проекций угловых скоростей тела 1 на его связанные оси и производной угла поворота второго тела относительно первого.</p>

\[\mathbf{u}=\left[\omega_x^{\left(1\right)},\omega_y^{\left(1\right)},\omega_z^{\left(1\right)},{\dot{\alpha}}_4\right]^T\]

<p>Эта особенность метода Кейна позволяет упростить вывод уравнений движения системы.</p>

<h3 id="скорость-и-ускорение-центра-масс-тела-1">Скорость и ускорение центра масс тела 1</h3>

<p>Вектор скорости центра масс первого тела определяется выражением:</p>

\[\vec{V}_1  = \vec{\omega}_1 \times (-\vec{c}_{11}).\]

<p>Координатная форма этого выражения в неподвижной СК \(A_1 x_0 y_0 z_0\) будет иметь вид:</p>

\[\mathbf{V}_1^{(0)}=\mathbf{A}^{01}{\widetilde{\mathbf{\omega}}}_1^{(1)}\ \left(-\mathbf{c}_{11}^{\left(1\right)}\right)=\mathbf{A}^{01}{\widetilde{\mathbf{c}}}_{11}^{\left(1\right)}\mathbf{\omega}_1^{(1)}=\left[\begin{matrix}\mathbf{A}^{01}{\widetilde{\mathbf{c}}}_{11}^{\left(1\right)}&amp;\mathbf{0}_3\\\end{matrix}\right]\mathbf{u}=\mathbf{Q}_{V1}^{(0)}\mathbf{u}\]

<p>Оператор тильда используется для матричной записи векторного произведения и преобразует координатный столбец вектора в кососимметрическую матрицу:</p>

\[\tilde{\mathbf a} = 
  \begin{bmatrix}
  0 &amp; -a_z &amp; a_y \\
  a_z &amp; 0 &amp; -a_x \\
 -a_y &amp; a_x &amp; 0
  \end{bmatrix}, \quad \mathbf a \times \mathbf b = \tilde{\mathbf a} \mathbf b\]

<p>Матрица \(\mathbf{Q}_{V1}^{(0)}\) имеет размерность \(3\times n\), где \(n\) – число степеней свободы системы. Каждый столбец этой матрицы представляет собой частную скорость центра масс тела 1, например, первый вектор \(\mathbf{u}_{11}\) можно получить следующим образом:</p>

\[\mathbf{u}_{11} = \mathbf{Q}_{V1}^{(0)} \begin{bmatrix} 1 \\ 0 \\ 0 \\ 0 \end{bmatrix}.\]

<p>Координатный столбец ускорения центра масс получим, продифференцировав выражение для скорости:</p>

\[\mathbf{a}_1^{(0)} = \mathbf{Q}_{V1}^{(0)} \dot{\mathbf{u}} + \dot{\mathbf{Q}}_{V1}^{(0)} \dot{\mathbf{u}}\]

<p>Производная матрицы частных векторов:</p>

\[\dot{\mathbf{Q}}_{V1}^{(0)} = \begin{bmatrix} \mathbf{A}^{01} \tilde{\boldsymbol \omega}_1^((1) ) \tilde{\mathbf c}_{11}^{(1)} &amp;  \mathbf{0}_3 \end{bmatrix}\]

<p>где \({0}_3\) – столбец нулей \(3 \times 1\).</p>

<h3 id="угловая-и-скорость-ускорение-тела-1">Угловая и скорость ускорение тела 1</h3>

<p>Координатный столбец вектора угловой скорости первого тела в проекциях на собственные оси будет определяться выражением</p>

\[\boldsymbol{\omega}_1^{(1)} = \begin{pmatrix} \mathbf{E}_{3} &amp; \mathbf{0}_3 \end{pmatrix} \mathbf{u} = \mathbf{Q}_{w1}^{(1)} \mathbf{u}\]

<p>Матрица \(\mathbf{Q}_{w1}^{(1)}\) как и матрица \(\mathbf{Q}_{V1}^{(0)}\) имеет размерность \(3\times n\), где \(n\). Каждый столбец матрицы представляет собой частную угловую скорость тела 1.</p>

<p>Угловое ускорение тела 1</p>

\[\boldsymbol{\varepsilon}_1^{(1)} = \mathbf{Q}_{w1}^{(1)} \dot{\mathbf{u}} + \dot{\mathbf{Q}}_{w1}^{(1)} \mathbf{u}\]

<p>Матрица  \(\mathbf{Q}_{w1}^{(1)}\) не зависит от времени, поэтому \(\dot{\mathbf{Q}}_{V1}^{(0)} = 0\).</p>

<h3 id="скорость-и-ускорение-центра-масс-тела-2">Скорость и ускорение центра масс тела 2</h3>

<p>Вектор скорости центра масс второго тела представляет собой сумму скорости движения второго тела вместе с первым и скорости второго тела относительно первого:</p>

\[\vec{V}_2  = \vec{V}_{2}^e + \vec{V}_{2}^r = \vec{\omega}_1 \times (-\vec{c}_{11}+\vec{c}_{12}-\vec{c}_{22})\]

<p>В координатной матричной форме это выражение имеет вид:</p>

\[\mathbf{V}_2^{\left(0\right)}=\mathbf{A}^{01}{\widetilde{\mathbf{\omega}}}_1^{\left(1\right)}\ \left(-\mathbf{c}_{11}^{\left(1\right)}+\mathbf{c}_{12}^{\left(1\right)}-\mathbf{A}^{12}\mathbf{c}_{22}^{\left(2\right)}\right)+\mathbf{A}^{01}\mathbf{A}^{12}\left(-{\widetilde{\mathbf{e}}}_y\mathbf{c}_{22}^{\left(2\right)}\right){\dot{\alpha}}_4\]

<p>где \(\mathbf{e}_y  = [0,1,0]\) – единичный вектор оси y – оси вращения второго тела относительно первого.</p>

<p>Изменим порядок векторного произведения для того, чтобы вынести координатный столбец угловой скорости первого тела в правую часть выражения:</p>

\[\mathbf{V}_2^{\left(0\right)} = -\mathbf{A}^{01}\left(-{\widetilde{\mathbf{c}}}_{11}^{\left(1\right)}+{\widetilde{\mathbf{c}}}_{12}^{\left(1\right)}-\widetilde{\mathbf{A}^{12}\mathbf{c}_{22}^{\left(2\right)}}\right)\mathbf{\omega}_1^{\left(1\right)}+\mathbf{A}^{01}\mathbf{A}^{12}{\widetilde{\mathbf{c}}}_{22}^{\left(2\right)}\mathbf{e}_y{\dot{\alpha}}_4\]

<p>и введем матрицу частных скоростей тела 2 \(\mathbf{Q}_{V2}^{(0)}\):</p>

\[\mathbf{V}_2^{\left(0\right)} = \left[-\begin{matrix}\mathbf{A}^{01}\left(-{\widetilde{\mathbf{c}}}_{11}^{\left(1\right)}+{\widetilde{\mathbf{c}}}_{12}^{\left(1\right)}-\widetilde{\mathbf{A}^{12}\mathbf{c}_{22}^{\left(2\right)}}\right)&amp;\mathbf{A}^{01}\mathbf{A}^{12}{\widetilde{\mathbf{c}}}_{22}^{\left(2\right)}\mathbf{e}_y\\\end{matrix}\right]\mathbf{u}=\mathbf{Q}_{V2}^{(0)}\mathbf{u}\]

<p>Продифференцируем выражение для \(\mathbf{V}_2^{\left(0\right)}\) для определения ускорения центра масс тела 2:</p>

\[\mathbf{a}_1^{(0)}=\mathbf{Q}_{V1}^{(0)}\dot{\mathbf{u}}+{\dot{\mathbf{Q}}}_{V1}^{(0)}\mathbf{u}\]

<p>где \({\dot{\mathbf{Q}}}_{V1}^{(0)}\) – производная матрицы \(\mathbf{Q}_{V2}^{(0)}\):</p>

\[{\dot{\mathbf{Q}}}_{V2}^{(0)}=
\begin{bmatrix}
-\mathbf{A}^{01}{\widetilde{\mathbf{\omega}}}_1^{\left(1\right)}\left(-{\widetilde{\mathbf{c}}}_{11}^{\left(1\right)}+{\widetilde{\mathbf{c}}}_{12}^{\left(1\right)}-\widetilde{\mathbf{A}^{12}\mathbf{c}_{22}^{\left(2\right)}}\right)+\mathbf{A}^{01}\widetilde{\left(\mathbf{A}^{12}{\widetilde{\mathbf{\Omega}}}_2^{\left(2\right)}\mathbf{c}_{22}^{\left(2\right)}\right)} &amp;
\mathbf{A}^{01}{\widetilde{\mathbf{\omega}}}_1^{\left(1\right)}\mathbf{A}^{12}{\widetilde{\mathbf{c}}}_{22}^{\left(2\right)}\mathbf{e}_y+\mathbf{A}^{01}\mathbf{A}^{12}{\widetilde{\mathbf{\Omega}}}_2^{\left(2\right)}{\widetilde{\mathbf{c}}}_{22}^{\left(2\right)}\mathbf{e}_y
\end{bmatrix}\]

<h3 id="угловая-скорость-и-ускорение-второго-тела">Угловая скорость и ускорение второго тела</h3>

<p>Угловая скорость тела 2 определяется угловой скоростью тела 1 (\(\vec{\omega}_1\)) и угловой скоростью тела 2 относительно тела 1 (\(\vec{\Omega}_2\)):</p>

\[\vec{\omega}_2 = \vec{\omega}_1 + \vec{\Omega}_2.\]

<p>В матричной координатной форме это выражение имеет вид (в системе координат тела 2):</p>

\[\boldsymbol{\omega}_2^{(2)}=\left[\left(\mathbf{A}^{12}\right)^T\mathbf{E}_\mathbf{3}\ \ \ \mathbf{e}_y\right]\dot{\mathbf{u}}=\mathbf{Q}_{w2}^{(2)}\mathbf{u}\]

<p>Координатный столбец углового ускорения тела 2 определим дифференцированием выражения для \(\boldsymbol{\omega}_2^{(2)}\):</p>

\[\boldsymbol{\varepsilon}_2^{(2)}=\mathbf{Q}_{w2}^{(2)}\dot{\mathbf{u}}+{\dot{\mathbf{Q}}}_{w2}^{(2)}\mathbf{u}\]

<p>где</p>

\[{\dot{\mathbf{Q}}}_{w2}^{(2)}=\left[\left(\mathbf{A}^{12}{\widetilde{\mathbf{\Omega}}}_2^{\left(2\right)}\right)^T\mathbf{E}_\mathbf{3}\ \ \ \mathbf{0}_3\right]\]

<h2 id="силы">Силы</h2>

<p>Движение механической системы  происходит под действием силы тяжести, действующей отрицательном направлении оси \(Oz_0\). Координатные столбцы сил, действующих на тела 1 и 2 в неподвижном базисе:</p>

\[\mathbf{F}_1^{(0)} = [0,0,-m_1 g]^T, \quad \mathbf{F}_2^{(0)} = [0,0,-m_2 g]^T\]

<h2 id="уравнения-движения">Уравнения движения</h2>

<p>Сила инерции первого тела определяется выражением:</p>

\[\boldsymbol{\Phi}_1 = - m_1 \mathbf{a}_1 = - m_1 [ \mathbf{Q}_{V1}^{(0)} \dot{\mathbf{u}} + \dot{\mathbf{Q}}_{V1}^{(0)} \mathbf{u} ]\]

<p>Это выражение необходимо умножить скалярно на соответствующие частные скорости центра масс первого тела. Учитывая, что необходимые частные скорости это столбцы матрицы \(\mathbf{Q}_{V1}^{(0)}\), скалярное произведение можно записать в матричном виде следующим образом</p>

\[\mathbf{Q}_{v1} = \begin{bmatrix}
  \mathbf{u}_{11} \cdot \boldsymbol{\Phi}_1  \\
  \mathbf{u}_{12} \cdot \boldsymbol{\Phi}_1  \\
  \mathbf{u}_{13} \cdot \boldsymbol{\Phi}_1  \\
  \mathbf{u}_{14} \cdot \boldsymbol{\Phi}_1  \\
  \end{bmatrix} =   
  (\mathbf{Q}_{V1}^{(0)})^T \left\{- m_1 \left( \mathbf{Q}_{V1}^{(0)} \dot{\mathbf{u}} + \dot{\mathbf{Q}}_{V1}^{(0)} \mathbf{u} \right) \right\}\]

<p>Главный момент сил инерции тела 1</p>

\[\mathbf M_{c1}^{\Phi} = - \mathbf{J}_1 \boldsymbol{\varepsilon}_1^{(1)} - \boldsymbol{\omega_1}^{(1)} \times \mathbf{J}_1 \boldsymbol{\omega}_1^{(1)}\]

<p>скалярно умножается на частные угловые скорости тела 1:</p>

\[\mathbf{Q}_{w1} = 
  \begin{bmatrix}
  \mathbf{w}_{11} \cdot \mathbf M_{c1}^{\Phi}  \\
  \mathbf{w}_{12} \cdot \mathbf M_{c1}^{\Phi}  \\
  \mathbf{w}_{13} \cdot \mathbf M_{c1}^{\Phi}  \\
  \mathbf{w}_{14} \cdot \mathbf M_{c1}^{\Phi}  \\
  \end{bmatrix} = 
  (\mathbf{Q}_{w1}^{(1)})^T \left[- \mathbf{J}_1 (\mathbf{Q}_{w1}^{(1)} \dot{\mathbf{u}} + \dot{\mathbf{Q}}_{w1}^{(1)} \mathbf{u}) - \boldsymbol{\omega_1}^{(1)} \times \mathbf{J}_1 \boldsymbol{\omega}_1^{(1)} \right]\]

<p>Аналогичные выражения определяются для тела 2</p>

\[\mathbf{Q}_{v2} = \begin{bmatrix}
  \mathbf{u}_{21} \cdot \boldsymbol{\Phi}_2  \\
  \mathbf{u}_{22} \cdot \boldsymbol{\Phi}_2  \\
  \mathbf{u}_{23} \cdot \boldsymbol{\Phi}_2  \\
  \mathbf{u}_{24} \cdot \boldsymbol{\Phi}_2  \\
  \end{bmatrix} =   
  (\mathbf{Q}_{V2}^{(0)})^T \left\{- m_2 \left( \mathbf{Q}_{V2}^{(0)} \dot{\mathbf{u}} + \dot{\mathbf{Q}}_{V2}^{(0)} \mathbf{u} \right) \right\}\]

\[\mathbf{Q}_{w2} = 
  \begin{bmatrix}
  \mathbf{w}_{21} \cdot \mathbf M_{c1}^{\Phi}  \\
  \mathbf{w}_{22} \cdot \mathbf M_{c1}^{\Phi}  \\
  \mathbf{w}_{23} \cdot \mathbf M_{c1}^{\Phi}  \\
  \mathbf{w}_{24} \cdot \mathbf M_{c1}^{\Phi}  \\
  \end{bmatrix} = 
  (\mathbf{Q}_{w2}^{(2)})^T \left[- \mathbf{J}_2 (\mathbf{Q}_{w2}^{(2)} \dot{\mathbf{u}} + \dot{\mathbf{Q}}_{w2}^{(2)} \mathbf{u}) - \boldsymbol{\omega}_2^{(2)} \times \mathbf{J}_2 \boldsymbol{\omega}_2^{(2)} \right]\]

<p>Далее определяются обобщенные силы. Поскольку силы приложены в центрах масс тел, векторы этих сил скалярно умножаются на соответствующие частные линейные скорости центров масс:</p>

\[\mathbf{F}_{v1} = (\mathbf{Q}_{V1}^{(0)})^T \mathbf{F}_1\]

\[\mathbf{F}_{v2} = (\mathbf{Q}_{V2}^{(0)})^T \mathbf{F}_2\]

<p>Сложив полученные обобщённые силы</p>

\[\mathbf Q_{v1} + \mathbf Q_{v2} + \mathbf Q_{w1} + \mathbf Q_{w2} +\mathbf Q_{v1} + \mathbf{F}_{v1} + \mathbf{F}_{v2} = 0,\]

<p>и выделив слагаемые с производной координатного столбца скорости, получим систему дифференциальных уравнений в матричной форме относительно \(\dot{\mathbf{u}}\):</p>

\[\mathbf{Q}_{v1} + \mathbf{Q}_{v2} + \mathbf{Q}_{w1} + \mathbf{Q}_{w1} + \mathbf{F}_{v1} + \mathbf{F}_{v2} = 0\]

\[\begin{aligned}
&amp; \sum_{i=1}^{2}{\left\{-m_i\left[\mathbf{Q}_{Vi}^{\left(0\right)}\right]^T\mathbf{Q}_{Vi}^{\left(0\right)}-\left[\mathbf{Q}_{wi}^{\left(i\right)}\right]^T\mathbf{J}_i^{\left(i\right)}\mathbf{Q}_{wi}^{\left(i\right)}\right\}\dot{\mathbf{u}}} = \\ 
&amp; = \sum_{i=1}^{2}{m_i\left[\mathbf{Q}_{Vi}^{\left(0\right)}\right]^T{\dot{\mathbf{Q}}}_{Vi}^{\left(0\right)}\mathbf{u}} + \sum_{i=1}^{2}{\left[\mathbf{Q}_{wi}^{\left(i\right)}\right]^T\left[\mathbf{J}_i^{\left(i\right)}{\dot{\mathbf{Q}}}_{wi}^{\left(i\right)}\mathbf{u}+{\widetilde{\mathbf{\omega}}}_i^{\left(i\right)}\mathbf{J}_i^{\left(i\right)}\mathbf{\omega}_i^{\left(i\right)}\right]\ } - \sum_{i=1}^{2}{\left(\mathbf{Q}_{Vi}^{\left(0\right)}\right)^T\mathbf{F}_i} 
\end{aligned}\]

<p>Эти уравнения интегрируются совместно кинематическими уравнениями, связывающими производные углов с угловыми скоростями:</p>

\[\dot{\alpha}_1 = \sec \alpha_2 (\omega_{1x}^{(1)} \cos \alpha_3 - \omega_{1y}^{(1)} \sin \alpha_3),\]

\[\dot{\alpha}_2 = \omega_{1x}^{(1)} \sin \alpha_3 + \omega_{1y}^{(1)} \cos \alpha_3,\]

\[\dot{\alpha}_3 = \tan \alpha_2 (\omega_{1y}^{(1)} \sin \alpha_3 - \omega_{1x}^{(1)} \cos \alpha_3) + \omega_{1z}^{(1)}.\]

<h2 id="matlab-код">MATLAB-код</h2>

<h3 id="главный-файл-скрипт">Главный файл-скрипт</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">clear</span> <span class="nb">all</span><span class="p">;</span> <span class="nb">clc</span><span class="p">;</span>

<span class="c1">% Матрицы тензоров инерции тел в главных центральных осях</span>
<span class="n">p</span><span class="o">.</span><span class="n">J1</span> <span class="o">=</span> <span class="nb">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">;</span>
<span class="n">p</span><span class="o">.</span><span class="n">J2</span> <span class="o">=</span> <span class="nb">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">;</span>
<span class="c1">% Шарнирные векторы</span>
<span class="n">p</span><span class="o">.</span><span class="n">c11</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="n">p</span><span class="o">.</span><span class="n">c12</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<span class="n">p</span><span class="o">.</span><span class="n">c22</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="c1">% Массы тел</span>
<span class="n">p</span><span class="o">.</span><span class="n">m1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">p</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">% Ускорение свободного падения</span>
<span class="n">p</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.807</span><span class="p">;</span>

<span class="c1">% Начальные условия</span>
<span class="n">q0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">pi</span><span class="p">/</span><span class="mi">4</span><span class="p">;</span><span class="nb">pi</span><span class="p">/</span><span class="mi">4</span><span class="p">;</span><span class="nb">pi</span><span class="p">/</span><span class="mi">4</span><span class="p">;</span><span class="nb">pi</span><span class="p">/</span><span class="mi">4</span><span class="p">;</span>  <span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>

<span class="c1">% Относительная погрешность</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nb">odeset</span><span class="p">(</span><span class="s1">'RelTol'</span><span class="p">,</span><span class="mf">1e-7</span><span class="p">);</span>
<span class="c1">% Запуск процесса интегрирования</span>
<span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ode113</span><span class="p">(</span><span class="o">@</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="n">dqdt_kane</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">q0</span><span class="p">,</span><span class="n">opt</span><span class="p">);</span>

<span class="c1">% Графики</span>
<span class="nb">close</span> <span class="nb">all</span><span class="p">;</span>
<span class="nb">figure</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="p">/</span><span class="nb">pi</span><span class="p">);</span>
<span class="nb">legend</span><span class="p">(</span><span class="s1">'\alpha_1'</span><span class="p">,</span><span class="s1">'\alpha_2'</span><span class="p">,</span><span class="s1">'\alpha_3'</span><span class="p">,</span><span class="s1">'\alpha_4'</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'t, c'</span><span class="p">);</span> 
<span class="nb">ylabel</span><span class="p">(</span><span class="s1">'\alpha_i, градус'</span><span class="p">);</span>

<span class="nb">figure</span><span class="p">;</span>
<span class="nb">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">(:,</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="p">/</span><span class="nb">pi</span><span class="p">);</span>
<span class="nb">legend</span><span class="p">(</span><span class="s1">'\omega_{1x}'</span><span class="p">,</span><span class="s1">'\omega_{1y}'</span><span class="p">,</span><span class="s1">'\omega_{1z}'</span><span class="p">,</span><span class="s1">'d\alpha_4/dt'</span><span class="p">);</span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'t, c'</span><span class="p">);</span> 
<span class="nb">ylabel</span><span class="p">(</span><span class="s1">'Угловые скорости, ...^o/c'</span><span class="p">);</span>

</code></pre></div></div>

<h3 id="функция-правых-частей">Функция правых частей</h3>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">dqdt_kane</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

<span class="n">dq</span> <span class="o">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">% Матрицы элементарных поворотов</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">0</span> <span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="mi">0</span> <span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)];</span>
<span class="n">Ay</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">[</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="mi">0</span> <span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">;</span> <span class="o">-</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="mi">0</span> <span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)];</span>
<span class="n">Az</span> <span class="o">=</span> <span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">[</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span><span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">;</span> <span class="nb">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="mi">0</span><span class="p">;</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">];</span>
<span class="c1">% Единичные векторы осей</span>
<span class="n">ex</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>
<span class="n">ey</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>
<span class="n">ez</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">1</span><span class="p">];</span>
<span class="n">e0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>

<span class="c1">% Матрица-столбец скоростей</span>
<span class="n">u</span>  <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">);</span>

<span class="c1">% Матрица преобразования координат из 1 в 0</span>
<span class="n">A01</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">Ay</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">Az</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="c1">% Матрица преобразования координат из 2 в 1</span>
<span class="n">A12</span> <span class="o">=</span> <span class="n">Ay</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
<span class="c1">% Матрица преобразования координат из 2 в 0</span>
<span class="n">A02</span> <span class="o">=</span> <span class="n">A01</span><span class="o">*</span><span class="n">A12</span><span class="p">;</span>

<span class="c1">% Угловая скорость тела 1</span>
<span class="n">w1_1</span>  <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">);</span>
<span class="c1">% Относительная угловая скорость тела 2 относительно тела 1 в СК 2</span>
<span class="n">Ow1_2</span> <span class="o">=</span> <span class="n">ey</span><span class="o">*</span><span class="n">q</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="c1">% Абсолютная угловая скорость тела 2 в СК 2</span>
<span class="n">w2_2</span>  <span class="o">=</span> <span class="n">A12</span><span class="o">'*</span><span class="n">w1_1</span><span class="o">+</span><span class="n">Ow1_2</span><span class="p">;</span>

<span class="c1">% Частные линейные скорости центра масс С1 в 0</span>
<span class="n">Q1V_0</span>  <span class="o">=</span> <span class="p">[</span><span class="n">A01</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">c11</span><span class="p">)</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>
<span class="c1">% Производная Q1V_0</span>
<span class="n">dQ1V_0</span> <span class="o">=</span> <span class="p">[</span><span class="n">A01</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">w1_1</span><span class="p">)</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">c11</span><span class="p">)</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>

<span class="c1">% Частные линейные скорости центра масс С2 в 0</span>
<span class="n">Q2V_0</span>  <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">A01</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">tilde</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">c11</span><span class="p">)</span><span class="o">+</span><span class="n">tilde</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">c12</span><span class="p">)</span><span class="o">-</span><span class="n">tilde</span><span class="p">(</span><span class="n">A12</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">c22</span><span class="p">))</span> <span class="n">A01</span><span class="o">*</span><span class="n">A12</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">c22</span><span class="p">)</span><span class="o">*</span><span class="n">ey</span><span class="p">];</span>
<span class="n">dQ2V_0</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">A01</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">w1_1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tilde</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">c11</span><span class="p">)</span><span class="o">+</span><span class="n">tilde</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">c12</span><span class="p">)</span><span class="o">-</span><span class="n">tilde</span><span class="p">(</span><span class="n">A12</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">c22</span><span class="p">))</span><span class="o">+</span><span class="n">A01</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">A12</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">Ow1_2</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">c22</span><span class="p">),</span><span class="k">...</span>
          <span class="n">A01</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">w1_1</span><span class="p">)</span><span class="o">*</span><span class="n">A12</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">c22</span><span class="p">)</span><span class="o">*</span><span class="n">ey</span><span class="o">+</span><span class="n">A01</span><span class="o">*</span><span class="n">A12</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">Ow1_2</span><span class="p">)</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">c22</span><span class="p">)</span><span class="o">*</span><span class="n">ey</span><span class="p">];</span>

<span class="c1">% Частные угловые скорости 1 в 0 не нужны </span>
<span class="n">Q1w_1</span>  <span class="o">=</span> <span class="p">[</span><span class="nb">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="nb">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>
<span class="n">dQ1w_1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>

<span class="c1">% Частные угловые скорости 2 в 0 не нужны </span>
<span class="n">Q2w_2</span>  <span class="o">=</span> <span class="p">[</span><span class="n">A12</span><span class="o">'*</span><span class="nb">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">ey</span><span class="p">];</span>
<span class="n">dQ2w_2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">A12</span><span class="o">*</span><span class="n">tilde</span><span class="p">(</span><span class="n">Ow1_2</span><span class="p">))</span><span class="o">'*</span><span class="nb">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)];</span>

<span class="c1">% Силы тяжести</span>
<span class="n">F1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">m1</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">g</span><span class="p">];</span>
<span class="n">F2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">m2</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">g</span><span class="p">];</span>

<span class="c1">% Матрица масс</span>
<span class="n">M</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="n">Q1V_0</span><span class="s1">')*Q1V_0-p.m2*(Q2V_0'</span><span class="p">)</span><span class="o">*</span><span class="n">Q2V_0</span><span class="o">-</span><span class="p">(</span><span class="n">Q1w_1</span><span class="s1">')*(p.J1*Q1w_1)-(Q2w_2'</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">J2</span><span class="o">*</span><span class="n">Q2w_2</span><span class="p">;</span>

<span class="c1">% Матрица правых частей</span>
<span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="n">Q1V_0</span><span class="s1">')*dQ1V_0*u-(Q1w_1'</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">J1</span><span class="o">*</span><span class="n">dQ1w_1</span><span class="o">*</span><span class="n">u</span><span class="o">+</span><span class="n">tilde</span><span class="p">(</span><span class="n">w1_1</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">J1</span><span class="o">*</span><span class="n">w1_1</span><span class="p">)</span><span class="o">-</span><span class="k">...</span>
       <span class="n">p</span><span class="o">.</span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="n">Q2V_0</span><span class="s1">')*dQ2V_0*u-(Q2w_2'</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">J2</span><span class="o">*</span><span class="n">dQ2w_2</span><span class="o">*</span><span class="n">u</span><span class="o">+</span><span class="n">tilde</span><span class="p">(</span><span class="n">w2_2</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">J2</span><span class="o">*</span><span class="n">w2_2</span><span class="p">)</span><span class="o">+</span><span class="k">...</span>
       <span class="p">(</span><span class="n">Q1V_0</span><span class="s1">')*F1+(Q2V_0'</span><span class="p">)</span><span class="o">*</span><span class="n">F2</span>  <span class="p">);</span>

<span class="c1">% Решаем СЛУ относительно старших производных (угловых ускорений)</span>
<span class="n">du</span> <span class="o">=</span> <span class="n">M</span><span class="p">\</span><span class="n">B</span><span class="p">;</span>

<span class="c1">% Кинематические уравнения</span>
<span class="c1">% Производные углов</span>
<span class="n">dq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">sec</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">)));</span>
<span class="n">dq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="n">q</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="n">dq</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">tan</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="nb">sin</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">-</span><span class="n">q</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span><span class="o">+</span><span class="n">q</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
<span class="n">dq</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="c1">% Угловые ускорения</span>
<span class="n">dq</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">du</span><span class="p">;</span>

<span class="k">end</span>
</code></pre></div></div>]]></content><author><name></name></author><category term="mechanics" /><category term="CAE" /><category term="matlab" /><summary type="html"><![CDATA[Derivation of the equations of spatial motion for a system of two bodies using the Kane method.]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://classmech.github.io/assets/img/blog/kane-two-bodies-model_cover.png" /><media:content medium="image" url="https://classmech.github.io/assets/img/blog/kane-two-bodies-model_cover.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Уравнения относительного орбитального движения</title><link href="https://classmech.github.io/blog/mechanics/2024-07-21-relative_orbital_motion/" rel="alternate" type="text/html" title="Уравнения относительного орбитального движения" /><published>2024-07-21T00:00:00-05:00</published><updated>2024-07-21T00:00:00-05:00</updated><id>https://classmech.github.io/blog/mechanics/relative_orbital_motion</id><content type="html" xml:base="https://classmech.github.io/blog/mechanics/2024-07-21-relative_orbital_motion/"><![CDATA[<h2 id="система-координат">Система координат</h2>

<p>Рассматривается движение космического аппарата (КА) относительно орбитальной станции, движущейся по круговой или эллиптической орбите. Положение КА относительно станции определяется в орбитальной подвижной системе координат \(Ox_oy_oz_o\), связанной с центром масс станции. Ось \(Ox_o\) направлена по направлению  радиус вектора станции относительно центра Земли (\(\vec r\)), ось \(Oy_o\)  лежит в плоскости орбиты станции и направлена в направлении орбитального движения, ось \(Oz_o\) дополняет систему координат \(Ox_oy_oz_o\) до правой.</p>

<p><img src="/assets/img/mechanics-in-space/relative-orbital.svg" alt="" /></p>

<h2 id="нелинейные-уравнения-для-эллиптической-орбиты-станции">Нелинейные уравнения для эллиптической орбиты станции</h2>

<p>Нелинейные уравнения движения КА относительно станции при движении станции по эллиптической орбите имею следующий вид:</p>

\[\left\{
\begin{aligned}
&amp; \ddot x - 2 \dot{\vartheta} \dot y - \ddot{\vartheta} y - \dot{\vartheta}^2 x = - \frac{\mu(r+x)}{[(r+x)^2+y^2+z^2]^{3/2}} + \frac{\mu}{r^2} \\
&amp; \ddot y + \dot{\vartheta} \dot x + \ddot{\vartheta} x - \dot{\vartheta}^2 y = - \frac{\mu y}{[(r+x)^2+y^2+z^2]^{3/2}}\\
&amp; \ddot z = - \frac{\mu z}{[(r+x)^2+y^2+z^2]^{3/2}}
\end{aligned}
\right.\]

<p>где \(x, y, z\) – координаты КА относительно станции (проекции вектора \(\rho\) на оси орбитальной подвижной системы координат станции), \(\mu\) – гравитационный параметр Земли. Угол истинной аномалии станции \(\dot \vartheta\) и расстояние от станции до центра Земли \(r\), определяются дифференциальными уравнениями движения станции по эллиптической орбите:</p>

\[\ddot \vartheta = -\frac{2 \dot r \dot \vartheta}{r}, \quad \ddot{r} = r \dot{\vartheta}^2 - \frac{\mu}{r^2}.\]

<p>Функция правых частей на языке MATLAB</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">nonlinear_relative_orbital</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="n">r</span>       <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>     <span class="c1">% расстояние до притягивающего центра</span>
    <span class="n">theta</span>   <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>     <span class="c1">% угол истинной аномалии станции</span>
    <span class="n">rho</span>     <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">);</span>   <span class="c1">% относительные координаты</span>
    <span class="n">dr</span>      <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>     <span class="c1">% dr/dt</span>
    <span class="n">dtheta</span>  <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>     <span class="c1">% угловая скорость орбитального движения</span>
    <span class="n">v</span>       <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">);</span>  <span class="c1">% относительная скорость</span>
    
    <span class="c1">% Уравнения движения станции</span>
    <span class="n">d2r</span>     <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">dtheta</span><span class="o">^</span><span class="mi">2</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">mu</span><span class="p">/(</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">d2theta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">dr</span><span class="o">*</span><span class="n">dtheta</span><span class="p">/</span><span class="n">r</span><span class="p">;</span>
    
    <span class="n">rm</span>      <span class="o">=</span> <span class="nb">sqrt</span><span class="p">((</span><span class="n">r</span><span class="o">+</span><span class="n">rho</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="n">rho</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="n">rho</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span>
    
    <span class="n">d2x</span>     <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">rho</span><span class="p">(</span><span class="mi">1</span><span class="p">))/</span><span class="n">rm</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">mu</span><span class="p">/</span><span class="n">r</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">dtheta</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">d2theta</span><span class="o">*</span><span class="n">rho</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">dtheta</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">rho</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">d2y</span>     <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">mu</span><span class="o">*</span><span class="n">rho</span><span class="p">(</span><span class="mi">2</span><span class="p">)/</span><span class="n">rm</span><span class="o">^</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">dtheta</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d2theta</span><span class="o">*</span><span class="n">rho</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">dtheta</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">rho</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">d2z</span>     <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">mu</span><span class="o">*</span><span class="n">rho</span><span class="p">(</span><span class="mi">3</span><span class="p">)/</span><span class="n">rm</span><span class="o">^</span><span class="mi">3</span><span class="p">;</span>
    
    <span class="n">dq</span> <span class="o">=</span> <span class="p">[</span><span class="n">dr</span><span class="p">;</span><span class="n">dtheta</span><span class="p">;</span><span class="n">v</span><span class="p">;</span><span class="n">d2r</span><span class="p">;</span><span class="n">d2theta</span><span class="p">;</span><span class="n">d2x</span><span class="p">;</span><span class="n">d2y</span><span class="p">;</span><span class="n">d2z</span><span class="p">];</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="нелинейные-уравнения-относительного-движения-для-круговой-орбиты-станции">Нелинейные уравнения относительного движения для круговой орбиты станции</h2>

<p>При движении станции по круговой орбите \(\dot{\vartheta} = n_0 = \text{const}, \, \ddot{\vartheta}  = 0, \, r = a_0 = \text{const}\) уравнения упрощаются:</p>

\[\left\{
\begin{aligned}
&amp; \ddot x - 2 n_0 \dot y - n^2_0 x = - \frac{\mu(a_0+x)}{[(a_0+x)^2+y^2+z^2]^{3/2}} + \frac{\mu}{a_0^2} \\
&amp; \ddot y + n_0 \dot x - n^2_0 y = - \frac{\mu y}{[(a_0+x)^2+y^2+z^2]^{3/2}}\\
&amp; \ddot z = - \frac{\mu z}{[(a_0+x)^2+y^2+z^2]^{3/2}}
\end{aligned}
\right.\]

<h2 id="линеаризованные-уравнения-для-круговой-орбиты">Линеаризованные уравнения для круговой орбиты</h2>

<p>Для малого в сравнении с радиусом орбиты расстояния между станцией и КА (\(\rho &lt;&lt; a_0\)) приведенные выше можно линеаризовать и приводятся к простому виду:</p>

\[\left\{
\begin{aligned}
&amp; \ddot x - 2 n_0 \dot y - 3 n^2_0 x = 0 \\
&amp; \ddot y + 2 n_0 \dot x =  0 \\
&amp; \ddot z + n_0^2 z  = 0
\end{aligned}
\right.\]

<p>Эти уравнения  могут быть проинтегрированный аналитически:</p>

\[\begin{aligned}
&amp; x = x_0 (4 - 3\cos n_0t) + \frac{1}{n_0} \left[ \dot x_0 \sin n_0 t + 2 \dot y_0 (1-\cos n_0t) \right],\\
&amp; y  =  y_0 + \left[ 6x_0+\frac{4\dot y_0}{n_0}\right] \sin n_0 t + \frac{2 \dot x_0}{n}(\cos n_0 t-1) -\left[ 6n_0 x_0+3 \dot y_0\right]t,\\
&amp; z  = \frac{z_0}{n_0} \sin n_0 t + z_0 \cos n_0 t.
\end{aligned}\]

<h3 id="источники-и-ссылки">Источники и ссылки</h3>

<ol>
  <li>Alfriend K.T. et al. Spacecraft formation flying: Dynamics, control and navigation // Spacecraft Formation Flying: Dynamics, control and navigation. 2009.</li>
  <li><a href="/pages/mechanics-in-space/relative-orbital-motion/">Относительное орбитальное движение 1</a>.</li>
  <li><a href="https://classmech.ru/pages/matlab/lab_hill_frame/">Относительное орбитальное движение 2</a></li>
</ol>]]></content><author><name></name></author><category term="mechanics" /><category term="matlab" /><summary type="html"><![CDATA[Система координат Рассматривается движение космического аппарата (КА) относительно орбитальной станции, движущейся по круговой или эллиптической орбите. Положение КА относительно станции определяется в орбитальной подвижной системе координат \(Ox_oy_oz_o\), связанной с центром масс станции. Ось \(Ox_o\) направлена по направлению радиус вектора станции относительно центра Земли (\(\vec r\)), ось \(Oy_o\) лежит в плоскости орбиты станции и направлена в направлении орбитального движения, ось \(Oz_o\) дополняет систему координат \(Ox_oy_oz_o\) до правой. Нелинейные уравнения для эллиптической орбиты станции Нелинейные уравнения движения КА относительно станции при движении станции по эллиптической орбите имею следующий вид: \[\left\{ \begin{aligned} &amp; \ddot x - 2 \dot{\vartheta} \dot y - \ddot{\vartheta} y - \dot{\vartheta}^2 x = - \frac{\mu(r+x)}{[(r+x)^2+y^2+z^2]^{3/2}} + \frac{\mu}{r^2} \\ &amp; \ddot y + \dot{\vartheta} \dot x + \ddot{\vartheta} x - \dot{\vartheta}^2 y = - \frac{\mu y}{[(r+x)^2+y^2+z^2]^{3/2}}\\ &amp; \ddot z = - \frac{\mu z}{[(r+x)^2+y^2+z^2]^{3/2}} \end{aligned} \right.\] где \(x, y, z\) – координаты КА относительно станции (проекции вектора \(\rho\) на оси орбитальной подвижной системы координат станции), \(\mu\) – гравитационный параметр Земли. Угол истинной аномалии станции \(\dot \vartheta\) и расстояние от станции до центра Земли \(r\), определяются дифференциальными уравнениями движения станции по эллиптической орбите: \[\ddot \vartheta = -\frac{2 \dot r \dot \vartheta}{r}, \quad \ddot{r} = r \dot{\vartheta}^2 - \frac{\mu}{r^2}.\] Функция правых частей на языке MATLAB function dq = nonlinear_relative_orbital(t,q,p) r = q(1); % расстояние до притягивающего центра theta = q(2); % угол истинной аномалии станции rho = q(3:5); % относительные координаты dr = q(6); % dr/dt dtheta = q(7); % угловая скорость орбитального движения v = q(8:10); % относительная скорость % Уравнения движения станции d2r = r*dtheta^2-p.mu/(r^2); d2theta = -2*dr*dtheta/r; rm = sqrt((r+rho(1))^2+rho(2)^2+rho(3)^2); d2x = -p.mu*(r+rho(1))/rm^3 + p.mu/r^2 + 2*dtheta*v(2) + d2theta*rho(2) + dtheta^2*rho(1); d2y = -p.mu*rho(2)/rm^3 - 2*dtheta*v(1) - d2theta*rho(1) + dtheta^2*rho(2); d2z = -p.mu*rho(3)/rm^3; dq = [dr;dtheta;v;d2r;d2theta;d2x;d2y;d2z]; end Нелинейные уравнения относительного движения для круговой орбиты станции При движении станции по круговой орбите \(\dot{\vartheta} = n_0 = \text{const}, \, \ddot{\vartheta} = 0, \, r = a_0 = \text{const}\) уравнения упрощаются: \[\left\{ \begin{aligned} &amp; \ddot x - 2 n_0 \dot y - n^2_0 x = - \frac{\mu(a_0+x)}{[(a_0+x)^2+y^2+z^2]^{3/2}} + \frac{\mu}{a_0^2} \\ &amp; \ddot y + n_0 \dot x - n^2_0 y = - \frac{\mu y}{[(a_0+x)^2+y^2+z^2]^{3/2}}\\ &amp; \ddot z = - \frac{\mu z}{[(a_0+x)^2+y^2+z^2]^{3/2}} \end{aligned} \right.\] Линеаризованные уравнения для круговой орбиты Для малого в сравнении с радиусом орбиты расстояния между станцией и КА (\(\rho &lt;&lt; a_0\)) приведенные выше можно линеаризовать и приводятся к простому виду: \[\left\{ \begin{aligned} &amp; \ddot x - 2 n_0 \dot y - 3 n^2_0 x = 0 \\ &amp; \ddot y + 2 n_0 \dot x = 0 \\ &amp; \ddot z + n_0^2 z = 0 \end{aligned} \right.\] Эти уравнения могут быть проинтегрированный аналитически: \[\begin{aligned} &amp; x = x_0 (4 - 3\cos n_0t) + \frac{1}{n_0} \left[ \dot x_0 \sin n_0 t + 2 \dot y_0 (1-\cos n_0t) \right],\\ &amp; y = y_0 + \left[ 6x_0+\frac{4\dot y_0}{n_0}\right] \sin n_0 t + \frac{2 \dot x_0}{n}(\cos n_0 t-1) -\left[ 6n_0 x_0+3 \dot y_0\right]t,\\ &amp; z = \frac{z_0}{n_0} \sin n_0 t + z_0 \cos n_0 t. \end{aligned}\] Источники и ссылки Alfriend K.T. et al. Spacecraft formation flying: Dynamics, control and navigation // Spacecraft Formation Flying: Dynamics, control and navigation. 2009. Относительное орбитальное движение 1. Относительное орбитальное движение 2]]></summary></entry><entry><title type="html">Вывод и интегрирование уравнений движения эллиптического мятника в Python (использование sympy, scipy)</title><link href="https://classmech.github.io/blog/python/mechanics/2024-05-12-python-elliptic-pendulum/" rel="alternate" type="text/html" title="Вывод и интегрирование уравнений движения эллиптического мятника в Python (использование sympy, scipy)" /><published>2024-05-12T00:00:00-05:00</published><updated>2024-05-12T00:00:00-05:00</updated><id>https://classmech.github.io/blog/python/mechanics/python-elliptic-pendulum</id><content type="html" xml:base="https://classmech.github.io/blog/python/mechanics/2024-05-12-python-elliptic-pendulum/"><![CDATA[<p>Рассматриваемая механическая система имеет две степени свободы: её конфигурация определяется координатой \(x\)  тела 1 (брусок, движущийся поступательно вдоль оси \($Ox_0\)) и углом отклонения подвеса тела 2 от вертикали \(\phi\). Движение системы происходит в однородном поле силы тяжести.</p>

<p><img src="/assets/img/matlab/elliptic_pendulum.png" alt="" /></p>

<h2 id="вывод-уравнений-движения">Вывод уравнений движения</h2>

<p>Подключение необходимых библиотек:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Массивы и матрицы
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="c1"># Графики
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1"># Символьные вычисления
</span><span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="n">sp</span>
<span class="c1"># Численное интегрирование дифференциальных уравнений
</span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
</code></pre></div></div>

<h3 id="параметры-системы-и-обобщенные-координаты">Параметры системы и обобщенные координаты</h3>

<p>Уравнения движения системы запишем используя уравнения Лагранжа II-го рода. Для этого необходимо записать выражение для кинетической энергии системы \(T(q_1,\dot q_1,q_2,\dot q_2)\), аналитически продифференцировать его по обобщенной скорости, времени, обобщенной координате:</p>

\[\frac{d}{dt} \frac{\partial T}{\partial \dot q_i} -\frac{\partial T}{\partial q_i} = Q_{i}, \quad i=1,2\]

<p>Уравнения движения рассматриваемой механической системы будут выводиться с использованием библиотеки <a href="https://docs.sympy.org/latest/index.html">sympy</a>. Все переменные и параметры, которые будут входить в уравнения движения, необходимо объявить до их использования при помощи функции <strong>var</strong> или <strong>symbols</strong>.  Рассматриваемая система описывается следующими параметрами:</p>
<ul>
  <li>масса тела 1 (\(m_1\));</li>
  <li>масса тела 2 (\(m_2\));</li>
  <li>длина подвеса тела 2 (\(l = AB\));</li>
  <li>ускорение свободного падения (\(g\)).</li>
</ul>

<p>Таким образом, объявление этих параметров-символов будет иметь вид:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sp</span><span class="p">.</span><span class="n">var</span><span class="p">(</span><span class="s">'m1,m2,l,g'</span><span class="p">)</span>
</code></pre></div></div>

<p>Также необходимо объявить обобщенные координаты, которые являются функциями времени. Это делается при помощи функции <strong>Function</strong>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span>   <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Function</span><span class="p">(</span><span class="s">'x'</span><span class="p">)</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Function</span><span class="p">(</span><span class="s">'phi'</span><span class="p">)</span>
</code></pre></div></div>

<p>После объявления параметров и обобщенных координат (неизвестных пока функций времени) можно начать формирование выражений, необходимых для построения уравнений движения.</p>

<h3 id="кинематика-скорости-тел">Кинематика (скорости тел)</h3>

<p>Координатный <a href="https://docs.sympy.org/latest/tutorials/intro-tutorial/matrices.html">столбец</a> положения тела 1 в системе координат \(Ox_0y_0\) в sympy определим при помощи объекта типа <a href="(https://docs.sympy.org/latest/tutorials/intro-tutorial/matrices.html)">Матрица</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r1</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div>

<p>При формировании этого выражения указывается, что обобщенная координата – объявленная ранее  функция x является функцией времени.</p>

<p>Координатный столбец положения тела 2 в системе координат  \(Ox_0y_0\):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r2</span> <span class="o">=</span> <span class="n">r1</span> <span class="o">+</span> <span class="n">l</span><span class="o">*</span><span class="n">sp</span><span class="p">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">sp</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span><span class="n">sp</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">))])</span>
</code></pre></div></div>

<p>Координатный столбец вектора скорости тела 1 определим дифференцированием координатного столбца положения тела 1 по времени, для этого используем функцию <a href="https://docs.sympy.org/latest/tutorials/intro-tutorial/calculus.html">diff</a>, передав ей дифференцируемое выражение и имя параметра, по которому выполняется дифференцирование:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v1</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> 
<span class="n">v1</span>
</code></pre></div></div>

\[\left[\begin{matrix}\frac{d}{d t} x{\left(t \right)}\\0\end{matrix}\right]\]

<p>Аналогично определим координатный столбец вектора скорости тела 2:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v2</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="n">v2</span>
</code></pre></div></div>

\[\displaystyle \left[\begin{matrix}l \cos{\left(\phi{\left(t \right)} \right)} \frac{d}{d t} \phi{\left(t \right)} + \frac{d}{d t} x{\left(t \right)}\\- l \sin{\left(\phi{\left(t \right)} \right)} \frac{d}{d t} \phi{\left(t \right)}\end{matrix}\right]\]

<h3 id="левая-часть-уравнений-лагранжа">Левая часть уравнений Лагранжа</h3>

<p>Кинетическая энергия рассматриваемой системы определяется суммой кинетических энергий тела 1 и тела 2:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">T</span> <span class="o">=</span> <span class="n">m1</span><span class="o">*</span><span class="n">v1</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">m2</span><span class="o">*</span><span class="n">v2</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">T</span>
</code></pre></div></div>

\[\frac{m_{1} \left(\frac{d}{d t} x{\left(t \right)}\right)^{2}}{2} + \frac{m_{2} \left(l^{2} \sin^{2}{\left(\phi{\left(t \right)} \right)} \left(\frac{d}{d t} \phi{\left(t \right)}\right)^{2} + \left(l \cos{\left(\phi{\left(t \right)} \right)} \frac{d}{d t} \phi{\left(t \right)} + \frac{d}{d t} x{\left(t \right)}\right)^{2}\right)}{2}\]

<p>Используя функцию <strong>diff</strong> найдем левую часть уравнений Лагранжа II-го рода для первой обобщенной координаты \(\phi\):</p>

\[\frac{d}{dt} \frac{\partial T}{\partial \dot \phi} -\frac{\partial T}{\partial \phi} = Q_\phi\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">eq1</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span> <span class="n">T</span><span class="p">,</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">t</span><span class="p">)</span> <span class="p">),</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="c1"># Упрощаем
</span><span class="n">eq1</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">eq1</span><span class="p">)</span>
<span class="n">eq1</span>
</code></pre></div></div>

\[l m_{2} \left(l \frac{d^{2}}{d t^{2}} \phi{\left(t \right)} + \cos{\left(\phi{\left(t \right)} \right)} \frac{d^{2}}{d t^{2}} x{\left(t \right)}\right)\]

<p>Левая часть уравнения Лагранжа II-го рода для второй обобщенной координаты \(x\):</p>

\[\frac{d}{dt} \frac{\partial T}{\partial \dot x} -\frac{\partial T}{\partial x} = Q_x\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">eq2</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">simplify</span><span class="p">(</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span> <span class="n">T</span><span class="p">,</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">t</span><span class="p">)</span> <span class="p">),</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="p">)</span>
<span class="n">eq2</span>
</code></pre></div></div>

\[l m_{2} \left(l \frac{d^{2}}{d t^{2}} \phi{\left(t \right)} + \cos{\left(\phi{\left(t \right)} \right)} \frac{d^{2}}{d t^{2}} x{\left(t \right)}\right)\]

<h3 id="обобщенные-силы">Обобщенные силы</h3>

<p>Механическая система в однородном поле силы тяжести, поэтому для определения обобщенных сил удобней использовать выражение для потенциальной энергии системы, определенной из условия того, что уровень y = 0 является уровнем нулевой потенциальной энергии:</p>

\[\Pi = - m_2 g l \cos \phi\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">P</span> <span class="o">=</span> <span class="o">-</span><span class="n">m2</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<p>Обобщенная сила для первой обобщенной координаты:</p>

\[Q_\phi = - \frac{\partial \Pi}{\partial \phi}\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Q1</span> <span class="o">=</span> <span class="o">-</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</code></pre></div></div>

<p>Обобщенная сила для второй обобщенной координаты:</p>

\[Q_x = - \frac{\partial \Pi}{\partial x}\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Q2</span> <span class="o">=</span> <span class="o">-</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="приведение-уравнений-к-форме-коши">Приведение уравнений к форме Коши</h3>

<p>Разрешим полученную систему дифференциальных уравнений (eq1 = Q1, eq2 = Q2) относительно старших производных, используя функцию <a href="https://www.geeksforgeeks.org/python-sympy-solve-method/">solve</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">сauchy_form</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span> <span class="p">(</span><span class="n">eq1</span> <span class="o">-</span> <span class="n">Q1</span><span class="p">,</span> <span class="n">eq2</span> <span class="o">-</span> <span class="n">Q2</span><span class="p">),</span> <span class="p">(</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)))</span>
<span class="n">сauchy_form</span>
</code></pre></div></div>

<p>Функция <a href="https://www.geeksforgeeks.org/python-sympy-solve-method/">solve</a>  возвращает решение в виде словаря:</p>

\[\left\{ \frac{d^{2}}{d t^{2}} \phi{\left(t \right)} : - \frac{g m_{1} \sin{\left(\phi{\left(t \right)} \right)}}{l m_{1} - l m_{2} \cos^{2}{\left(\phi{\left(t \right)} \right)} + l m_{2}} - \frac{g m_{2} \sin{\left(\phi{\left(t \right)} \right)}}{l m_{1} - l m_{2} \cos^{2}{\left(\phi{\left(t \right)} \right)} + l m_{2}} - \frac{l m_{2} \sin{\left(\phi{\left(t \right)} \right)} \cos{\left(\phi{\left(t \right)} \right)} \left(\frac{d}{d t} \phi{\left(t \right)}\right)^{2}}{l m_{1} - l m_{2} \cos^{2}{\left(\phi{\left(t \right)} \right)} + l m_{2}}, \  \frac{d^{2}}{d t^{2}} x{\left(t \right)} : \frac{g m_{2} \sin{\left(\phi{\left(t \right)} \right)} \cos{\left(\phi{\left(t \right)} \right)}}{m_{1} - m_{2} \cos^{2}{\left(\phi{\left(t \right)} \right)} + m_{2}} + \frac{l m_{2} \sin{\left(\phi{\left(t \right)} \right)} \left(\frac{d}{d t} \phi{\left(t \right)}\right)^{2}}{m_{1} - m_{2} \cos^{2}{\left(\phi{\left(t \right)} \right)} + m_{2}}\right\}\]

<p>Для численного интегрирования уравнений движения преобразуем эту символьную функцию в функцию числовых аргументов (значений параметров системы и значений обобщенных координат и скоростей), которая будет возвращать вторые производные обобщенных координат. Для это используем функцию <a href="https://docs.sympy.org/latest/modules/utilities/lambdify.html">lambdify</a>.</p>

<p>Сформируем список аргументов этой функции: первые 4 элемента этого списка – параметры системы, оставшиеся 4 элемента — обобщенные координаты и скорости (всего 8 параметров):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">args</span> <span class="o">=</span> <span class="p">(</span> <span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">g</span><span class="p">,</span>   <span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">t</span><span class="p">),</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">t</span><span class="p">)</span> <span class="p">)</span>
</code></pre></div></div>

<p>Создаем функцию 8 аргументов, которая будет вычислять вторые производные обобщенных координат:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">accelerations</span> <span class="o">=</span> <span class="n">sp</span><span class="p">.</span><span class="n">lambdify</span><span class="p">(</span> <span class="n">args</span><span class="p">,</span> <span class="p">[</span> <span class="n">сauchy_form</span><span class="p">[</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span> <span class="n">сauchy_form</span><span class="p">[</span><span class="n">sp</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span> <span class="p">]</span> <span class="p">)</span>
</code></pre></div></div>

<p>Проверяем, как работает эта функция</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">accelerations</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">9.81</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.284409988846435</span><span class="p">,</span> <span class="mf">4.282768353189539</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="численное-интегрирование">Численное интегрирование</h3>

<p>Объявим функцию правых частей для численного интегрирования системы двух дифференциальных уравнений второго порядка:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dydt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>            
    <span class="p">(</span><span class="n">d2phi</span><span class="p">,</span> <span class="n">d2x</span><span class="p">)</span> <span class="o">=</span> <span class="n">accelerations</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>    
    <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">d2phi</span><span class="p">,</span> <span class="n">d2x</span><span class="p">)</span>  
</code></pre></div></div>

<p>Зададим параметры системы, начальные условия и проинтегрируем дифференциальные уравнения её движения:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Параметры системы: m1, m2, l, g
</span><span class="n">p</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">9.81</span><span class="p">];</span>
<span class="c1"># Начальные условия phi0, x0, dphi/dt, dx/dt
</span><span class="n">q0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>

<span class="n">solution</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">dydt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">q0</span><span class="p">,</span> 
                     <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"LSODA"</span><span class="p">,</span> <span class="n">t_eval</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="графики">Графики</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">solution</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">solution</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">);</span> <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span> <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'$\phi$, градус'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">solution</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">solution</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]);</span> <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span> <span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'x, м'</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/img/python/elliptic-pendulum-phi-x-plots.png" alt="" /></p>

<h2 id="анимация">Анимация</h2>

<p>Дополнительные библиотеки для построения графических примитивов и анимации.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="n">mlines</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Wedge</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">]);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Основание, по которому скользит первое тело
</span><span class="n">base</span>    <span class="o">=</span> <span class="n">mlines</span><span class="p">.</span><span class="n">Line2D</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'k'</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">'--'</span><span class="p">)</span> 
<span class="c1"># Подвеска тела 2
</span><span class="n">thread</span>  <span class="o">=</span> <span class="n">mlines</span><span class="p">.</span><span class="n">Line2D</span><span class="p">([</span><span class="n">q0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">q0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">q0</span><span class="p">[</span><span class="mi">0</span><span class="p">])],[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">q0</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span><span class="p">)</span> 
<span class="c1"># Аннотация (время)
</span><span class="n">text</span>    <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">'t = 0 c'</span><span class="p">,[</span><span class="mf">1.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span>
<span class="c1"># Тело 1 (брусок)
</span><span class="n">body1</span>   <span class="o">=</span> <span class="n">mlines</span><span class="p">.</span><span class="n">Line2D</span><span class="p">(</span><span class="n">q0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]),</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">]),</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">)</span> 
<span class="c1"># Тело 2 (шарик)
</span><span class="n">body2</span>   <span class="o">=</span> <span class="n">Wedge</span><span class="p">([</span><span class="n">q0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">q0</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">q0</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">fc</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>        
    <span class="n">ax</span><span class="p">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>        
    <span class="n">ax</span><span class="p">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">body1</span><span class="p">)</span>    
    <span class="n">ax</span><span class="p">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">body2</span><span class="p">)</span>    
    <span class="n">ax</span><span class="p">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ax</span><span class="p">,)</span>

<span class="k">def</span> <span class="nf">get_frame</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>        
    <span class="n">phi</span> <span class="o">=</span> <span class="n">solution</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> 
    <span class="n">x</span>   <span class="o">=</span> <span class="n">solution</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> 
    <span class="n">t</span>   <span class="o">=</span> <span class="n">solution</span><span class="p">.</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="n">x1</span> <span class="o">=</span>  <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span>  <span class="mi">0</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    
    <span class="n">thread</span><span class="p">.</span><span class="n">set_xdata</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">])</span>
    <span class="n">thread</span><span class="p">.</span><span class="n">set_ydata</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
    
    <span class="n">body1</span><span class="p">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]))</span>        
    <span class="n">body1</span><span class="p">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">]))</span>        
    
    <span class="n">body2</span><span class="p">.</span><span class="n">set_center</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>        
    
    <span class="n">text</span><span class="p">.</span><span class="n">set_text</span><span class="p">(</span><span class="s">'t = {:3.2f} c'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>    
    
    <span class="k">return</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="n">thread</span><span class="p">,</span><span class="n">body1</span><span class="p">,</span><span class="n">body2</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
    
<span class="n">anim</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">get_frame</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">solution</span><span class="p">.</span><span class="n">t</span><span class="p">),</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">anim</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'animation.gif'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/img/python/elliptic-pendulum-animation.gif" alt="" /></p>]]></content><author><name></name></author><category term="python" /><category term="mechanics" /><summary type="html"><![CDATA[The derivation of the equations of motion for an elliptical pendulum using the Python programming language and the sympy library is presented. The obtained equations are numerically integrated and an animation is created.]]></summary></entry><entry><title type="html">Пример скрипта для создания анимации в Blender на основе результатов расчётов</title><link href="https://classmech.github.io/blog/mechanics/2024-05-08-blender-script/" rel="alternate" type="text/html" title="Пример скрипта для создания анимации в Blender на основе результатов расчётов" /><published>2024-05-08T00:00:00-05:00</published><updated>2024-05-08T00:00:00-05:00</updated><id>https://classmech.github.io/blog/mechanics/blender-script</id><content type="html" xml:base="https://classmech.github.io/blog/mechanics/2024-05-08-blender-script/"><![CDATA[<p>В <a href="/assets/files/3d/lec1.blend">проекте Blender</a> создана следующая иерархия объектов:</p>
<ul>
  <li>Empty1 (Empty)
    <ul>
      <li>Body1 (Mesh)</li>
      <li>Empty2 (Empty)
        <ul>
          <li>Body2 (Mesh)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">bpy</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">mathutils</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># Удаление существующей анимации: 
# выделяем все объекты типа EMPTY (Add -&gt; Empty -&gt; Arrows)
</span><span class="n">bpy</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="nb">object</span><span class="p">.</span><span class="n">select_by_type</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">'EMPTY'</span><span class="p">)</span>
<span class="c1"># Удаляем, связанную с выделенными объектами анимацию
</span><span class="n">bpy</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="n">anim</span><span class="p">.</span><span class="n">keyframe_clear_v3d</span><span class="p">()</span>
<span class="n">bpy</span><span class="p">.</span><span class="n">ops</span><span class="p">.</span><span class="nb">object</span><span class="p">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s">'DESELECT'</span><span class="p">)</span>

<span class="c1"># Формируем список объектов типа Empty по их именам - систем координат (СК)
</span><span class="n">obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">bpy</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">objects</span><span class="p">[</span><span class="s">'Empty1'</span><span class="p">],</span> <span class="n">bpy</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">objects</span><span class="p">[</span><span class="s">'Empty2'</span><span class="p">])</span>

<span class="c1"># Читаем данные из файла
</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">'C:</span><span class="se">\\</span><span class="s">Users</span><span class="se">\\</span><span class="s">user</span><span class="se">\\</span><span class="s">results.csv'</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">)</span>

<span class="n">nframes</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nframes</span><span class="p">):</span>            
        <span class="c1"># Тело 1
</span>        <span class="n">phi11</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>                        
        <span class="n">phi12</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>                        
        <span class="c1"># Матрицы элементарных поворотов СК 1
</span>        <span class="n">A1</span> <span class="o">=</span> <span class="n">mathutils</span><span class="p">.</span><span class="n">Matrix</span><span class="p">.</span><span class="n">Rotation</span><span class="p">(</span><span class="n">phi11</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'X'</span><span class="p">)</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="n">mathutils</span><span class="p">.</span><span class="n">Matrix</span><span class="p">.</span><span class="n">Rotation</span><span class="p">(</span><span class="n">phi12</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'Y'</span><span class="p">)</span>
        <span class="c1"># Матрица сложного поворота 
</span>        <span class="c1"># преобразование координат из СК 0 в СК 1
</span>        <span class="n">A01</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span><span class="n">A2</span><span class="p">))</span>
        <span class="c1"># Сохраняем "кадр" анимации 
</span>        <span class="c1"># Поворот СК                
</span>        <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">matrix_local</span> <span class="o">=</span>  <span class="n">A01</span>        
        <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s">'rotation_euler'</span><span class="p">,</span><span class="n">frame</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="c1"># Положение СК
</span>        <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">location</span> <span class="o">=</span> <span class="n">mathutils</span><span class="p">.</span><span class="n">Vector</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))</span>    
        <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s">'location'</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                
        <span class="c1"># Тело 2
</span>        <span class="n">phi21</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="c1"># Матрицы элементарных поворотов СК 2 относительно СК 1 
</span>        <span class="n">A1</span> <span class="o">=</span> <span class="n">mathutils</span><span class="p">.</span><span class="n">Matrix</span><span class="p">.</span><span class="n">Rotation</span><span class="p">(</span><span class="n">phi21</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'X'</span><span class="p">)</span>
        <span class="c1"># Матрица сложного поворота из СК 1 в СК 2
</span>        <span class="n">A12</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">A1</span><span class="p">)</span>
        <span class="c1"># Поворот СК                
</span>        <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">matrix_local</span> <span class="o">=</span>  <span class="n">A12</span>
        <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s">'rotation_euler'</span><span class="p">,</span><span class="n">frame</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="c1"># Положение СК
</span>        <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">location</span> <span class="o">=</span> <span class="n">mathutils</span><span class="p">.</span><span class="n">Vector</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>    
        <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s">'location'</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
</code></pre></div></div>]]></content><author><name></name></author><category term="mechanics" /><summary type="html"><![CDATA[В проекте Blender создана следующая иерархия объектов: Empty1 (Empty) Body1 (Mesh) Empty2 (Empty) Body2 (Mesh) import bpy import math import sys import mathutils import csv import numpy as np # Удаление существующей анимации: # выделяем все объекты типа EMPTY (Add -&gt; Empty -&gt; Arrows) bpy.ops.object.select_by_type(type='EMPTY') # Удаляем, связанную с выделенными объектами анимацию bpy.ops.anim.keyframe_clear_v3d() bpy.ops.object.select_all(action='DESELECT') # Формируем список объектов типа Empty по их именам - систем координат (СК) obj = (bpy.data.objects['Empty1'], bpy.data.objects['Empty2']) # Читаем данные из файла data=np.loadtxt('C:\\Users\\user\\results.csv', delimiter=',') nframes = data.shape[0] for i in range(nframes): # Тело 1 phi11 = data[i,1] phi12 = data[i,2] # Матрицы элементарных поворотов СК 1 A1 = mathutils.Matrix.Rotation(phi11, 4, 'X') A2 = mathutils.Matrix.Rotation(phi12, 4, 'Y') # Матрица сложного поворота # преобразование координат из СК 0 в СК 1 A01 = np.transpose(np.dot(A1,A2)) # Сохраняем "кадр" анимации # Поворот СК obj[0].matrix_local = A01 obj[0].keyframe_insert(data_path='rotation_euler',frame=i) # Положение СК obj[0].location = mathutils.Vector((0.0,0.0,0.0)) obj[0].keyframe_insert(data_path='location', frame=i) # Тело 2 phi21 = data[i,3] # Матрицы элементарных поворотов СК 2 относительно СК 1 A1 = mathutils.Matrix.Rotation(phi21, 4, 'X') # Матрица сложного поворота из СК 1 в СК 2 A12 = np.transpose(A1) # Поворот СК obj[1].matrix_local = A12 obj[1].keyframe_insert(data_path='rotation_euler',frame=i) # Положение СК obj[1].location = mathutils.Vector((0.0,0.0,-1.0)) obj[1].keyframe_insert(data_path='location', frame=i)]]></summary></entry><entry><title type="html">Модели SimInTech</title><link href="https://classmech.github.io/blog/2024-04-30-simintech-projects-git/" rel="alternate" type="text/html" title="Модели SimInTech" /><published>2024-04-30T00:00:00-05:00</published><updated>2024-04-30T00:00:00-05:00</updated><id>https://classmech.github.io/blog/simintech-projects-git</id><content type="html" xml:base="https://classmech.github.io/blog/2024-04-30-simintech-projects-git/"><![CDATA[<p><a href="https://gitverse.ru/classmech/simintech">Хранилище (репозиторий) на GitVerse c примерами моделей</a>, разработанных в процессе освоения <a href="https://simintech.ru/">SimInTech</a>: файлы проектов со ссылками на их описание.</p>]]></content><author><name></name></author><category term="simintech" /><summary type="html"><![CDATA[Хранилище (репозиторий) на GitVerse c примерами моделей, разработанных в процессе освоения SimInTech: файлы проектов со ссылками на их описание.]]></summary></entry><entry><title type="html">Интегрирование уравнений движения системы с двумя степенями свободы в среде Python</title><link href="https://classmech.github.io/blog/mechanics/cae/2024-04-01-two-dof-python/" rel="alternate" type="text/html" title="Интегрирование уравнений движения системы с двумя степенями свободы в среде Python" /><published>2024-04-01T00:00:00-05:00</published><updated>2024-04-01T00:00:00-05:00</updated><id>https://classmech.github.io/blog/mechanics/cae/two-dof-python</id><content type="html" xml:base="https://classmech.github.io/blog/mechanics/cae/2024-04-01-two-dof-python/"><![CDATA[<p>Круглая пластина может вращаться вокруг оси, проходящей через точку \(О_1\) и перпендикулярной плоскости рисунка. В канале пластины движется шарик М, закреплённый на пружине со свободной длиной \(l_0\). Канал, в котором движется шарик, находится на расстоянии 2h = R от оси вращения.</p>

<p>Рассмотрим два режима движения системы:</p>
<ul>
  <li>движение системы при известном законе движения пластины;</li>
  <li>движение системы как системы с двумя степенями свободы.</li>
</ul>

<h2 id="система-с-одной-степенью-свободы">Система с одной степенью свободы</h2>

<p>В первом случае круглая пластина вращается по известному закону \(\varphi(t)\) и механическая система имеет только одну степень свободы – движение шарика относительно пластины.</p>

<p><img src="/assets/img/blog/two-dof-mech-python-1.png" alt="model.png" /></p>

<h3 id="уравнения-движения">Уравнения движения</h3>

<p>При движении пластины с известной угловой скоростью \(\dot{\varphi}(t) = \omega\) и ускорением \(\varepsilon\) уравнения относительного движения шарика относительно подвижной системы координат \(Oxy\), связанной с пластиной, имеют следующий вид:</p>

\[\left\{
\begin{aligned}
&amp; m \ddot x = G \sin \varphi - P - F_{f} + \Phi_e^n \sin \psi + \Phi_e^\tau \cos \psi \\
&amp; m \ddot y = G \cos \varphi + N_y + \Phi_e^n \cos \psi - \Phi_e^\tau \sin \psi - \Phi_c \\
&amp; m \ddot z = N_z
\end{aligned}
\right.\]

<p>где \(m\) - масса шарика, \(P = c \dot x\) - сила упругости пружины, \(F_f = \text{sign} (V_r) f \sqrt{N_y^2 + N_z^2}\) - сила трения скольжения, \(G  = m g\) - сила веса, \(\Phi_e^n\) - переносная центробежная сила  инерции:</p>

\[\Phi_e^n = m \omega^2 (O_1M) = m \omega^2 \frac{O_1K}{\cos \psi}\]

<p>переносная вращательная сила инерции:</p>

\[\Phi_e^\tau = m \varepsilon (O_1M) = m \varepsilon \frac{O_1K}{\cos \psi}\]

\[AK = \sqrt{R^2 - h^2}, \quad KM = (x + l_0) - AK, \quad \psi = \arctan \frac{KM}{O_1 K}\]

<p>Движение шарика происходит вдоль оси \(x\), поэтому \(y=0\). Из второго уравнения системы выразим реакцию \(N_y\):</p>

\[N_y = \Phi_e^\tau \sin \psi - G \cos \varphi - \Phi_e^n \cos \psi + \Phi_c\]

<p>Дифференциальное уравнение второго порядка, описывающее движения шарика вдоль оси \(Ox\), будет иметь вид:</p>

\[\ddot x = g \sin \varphi - \frac{c}{m} x - \text{sign}(V_r) f (\Phi_e^\tau \sin \psi - G \cos \varphi - \Phi_e^n \cos \psi)\frac{1}{m} + \frac{\Phi_e^n}{m} \sin \psi + \frac{\Phi_e^\tau}{m} \cos \psi = f(x,\dot x, t)\]

<p>Приведём это уравнение к системе дифференциальных уравнений первого порядка:</p>

\[\left\{
\begin{aligned}
&amp; \dot x = V_x \\
&amp; \dot V_x = f(x, V_x, t)
\end{aligned}
\right.\]

<p>Вектор состояния системы в момент времени t определяется координатным столбцом</p>

\[q(t) = \begin{bmatrix} x \\ V_x \end{bmatrix}\]

<p>Дифференциальные уравнения движения в матричной форме:</p>

\[\frac{dq}{dt} = f(q, t)\]

<p>Численно проинтегрируем полученные уравнения.</p>

<h3 id="функция-правых-частей">Функция правых частей</h3>

<p>Для численного интегрирования уравнений движения системы в среде Python необходимо создать функцию правых частей f(q,t). В начале разрабатываемой программы подключаем модуль для работы с массивами (array):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>

<p>и функцию интегрирования дифференциальных уравнений <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html">solve_ivp</a> из модуля <a href="https://docs.scipy.org/doc/scipy/reference/integrate.html">scipy.integrate</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
</code></pre></div></div>

<p>Для \(\varphi = \omega t\), \(\omega = \text{const}\) функция правых частей дифференциальных уравнений движения имеет вид:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dqdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>    
    <span class="n">x</span>   <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vx</span>  <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Параметры системы
</span>    <span class="n">g</span>   <span class="o">=</span> <span class="mf">9.807</span>   <span class="c1"># ускорение свободного падения
</span>    <span class="n">m</span>   <span class="o">=</span> <span class="mf">0.5</span>     <span class="c1"># масса шарика
</span>    <span class="n">w</span>   <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="c1"># угловая скорость пластины
</span>    <span class="n">c</span>   <span class="o">=</span> <span class="mi">150</span>     <span class="c1"># жёсткость пружины
</span>    <span class="n">L0</span>  <span class="o">=</span> <span class="mf">0.025</span>   <span class="c1"># свободная длина пружины
</span>    <span class="n">R</span>   <span class="o">=</span> <span class="mf">0.1</span>     <span class="c1"># радиус пластины
</span>    <span class="n">phi</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">t</span>     <span class="c1"># Угол поворота пластины    
</span>    <span class="n">f</span>   <span class="o">=</span> <span class="mf">0.0</span>     <span class="c1"># Коэффициент трения
</span>        
    <span class="c1"># Силы реакции 
</span>    <span class="n">Ny</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">vx</span><span class="o">-</span><span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">-</span><span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">R</span><span class="p">)</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Модуль силы реакции (для вычисления силы трения)
</span>    <span class="n">N</span>  <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ny</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Nz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> 
    
    <span class="c1"># Ускорение шарика
</span>    <span class="n">ax</span>  <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">c</span><span class="o">/</span><span class="n">m</span> <span class="o">-</span> <span class="n">f</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="n">m</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">L0</span><span class="o">+</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">R</span><span class="p">)</span>
        
    <span class="c1"># аргумент функции - вектор q содержит координату и скорость,
</span>    <span class="c1"># возвращаем производную от q, т.е. скорость и ускорение    
</span>    <span class="k">return</span> <span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</code></pre></div></div>

<p>Аргументы функции: t - время, q - вектор состояния системы для момента времени t. Для системы с одной степенью свободы это координата шарика x и его скорость vx.</p>

<h3 id="интегрирование">Интегрирование</h3>

<p>Численное интегрирование выполняется при помощи функции <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html">solve_ivp</a></p>

<p>Порядковые аргументы функции:</p>
<ol>
  <li>имя функции правой части системы ДУ</li>
  <li>интервал интегрирования от t0 до tN</li>
  <li>массив начальных условий</li>
</ol>

<p>Именованные аргументы:</p>
<ul>
  <li><strong>rtol</strong> - относительная погрешность</li>
  <li><strong>atol</strong> - абсолютная погрешность</li>
</ul>

<p>Ошибка на шаге интегрирования не превышает: atol + rtol * abs(y)</p>

<p>По умолчанию используется метод <a href="https://ru.wikipedia.org/wiki/Метод_Рунге_—_Кутты">Рунге-Кутты</a> с контролем точности и автоматическим выбором шага.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">dqdt</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">)</span>
</code></pre></div></div>

<p>Результат работы функции <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html">solve_ivp</a> - структура <strong>sol</strong> с результатами интегрирования:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    message: The solver successfully reached the end of the integration interval.
    success: True
    status: 0
        t: [ 0.000e+00  1.000e-04 ...  4.992e+00  5.000e+00]
        y: [[ 0.000e+00 -1.215e-08 ...  8.183e-03  1.020e-02]
            [ 0.000e+00 -2.429e-04 ...  2.862e-01  2.480e-01]]
      sol: None
 t_events: None
 y_events: None
     nfev: 1586
     njev: 0
      nlu: 0
</code></pre></div></div>

<p><strong>sol.t</strong> – Массив времени 1xN: первый элемент массива - начальное значение времени t0 последний элемент массива - конечное значение времени интегрирования tN.</p>

<p><strong>sol.y</strong> – таблица значений перемещения sol.y[0] и скорости шарика sol.y[1].</p>

<h3 id="построение-графиков">Построение графиков</h3>

<p>Для построения графиков необходимо подключить библиотеку <a href="https://matplotlib.org/">matplotlib</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</code></pre></div></div>

<p>Зададим параметры графиков по умолчанию: ширину и высоту графиков в дюймах, размер и тип шрифта</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"figure.figsize"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">17</span><span class="o">/</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">10</span><span class="o">/</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"font.size"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">"font.family"</span><span class="p">]</span> <span class="o">=</span> <span class="s">'Arial'</span>
</code></pre></div></div>

<p>Построим график изменения координаты шарика:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'x, м'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">'dotted'</span><span class="p">);</span>
</code></pre></div></div>

<p>Графики изменения координаты и скорости шарика можно показать на одном рисунке.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">'k-'</span><span class="p">,</span> <span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">'k--'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'м, м/с'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">'dotted'</span><span class="p">);</span>
</code></pre></div></div>

<p>В этом случае необходимо добавить <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.legend.html">“легенду”</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">((</span><span class="s">'Координата'</span><span class="p">,</span><span class="s">'Скорость'</span><span class="p">));</span>
</code></pre></div></div>
<p>​  <br />
По умолчанию “легенда” располагается на поле графика автоматически. Положение можно указать при помощи строкового параметра <strong>loc</strong>. Возможные значения:</p>
<ul>
  <li>‘best’</li>
  <li>‘upper right’</li>
  <li>‘upper left’</li>
  <li>‘lower left’</li>
  <li>‘lower right’</li>
  <li>‘right’</li>
  <li>‘center left’</li>
  <li>‘center right’</li>
  <li>‘lower center’</li>
  <li>‘upper center’</li>
  <li>‘center’</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">((</span><span class="s">'Координата'</span><span class="p">,</span><span class="s">'Скорость'</span><span class="p">),</span> <span class="n">loc</span> <span class="o">=</span> <span class="s">'upper left'</span><span class="p">);</span>
</code></pre></div></div>

<p>В подписях осей и легенде можно использовать LaTeX-разметку для математических символов</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'x, м, $V_x$, м/c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">((</span><span class="s">'x'</span><span class="p">,</span><span class="s">'$V_x$'</span><span class="p">));</span>
</code></pre></div></div>

<p>Для сохранения рисунка в графический файл используется функция <strong>savefig</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">"x_Vx.png"</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</code></pre></div></div>

<p>Еще один вариант построения графиков двух функций на одном рисунке, используя две оси y с разным масштабом</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">line1</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">'k-'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'x'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'x, м'</span><span class="p">);</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">line2</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">'k--'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'$V_x$'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'$V_x$, м/с'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/img/blog/two-dof-mech-python-x-v-1.png" alt="model.png" /></p>

<h3 id="передача-параметров-в-функцию-правых-частей">Передача параметров в функцию правых частей</h3>

<p>В приведенном выше примере параметры системы были определены в функции правых частей, что не является хорошей практикой программирования. При таком подходе при изменении параметров системы будет необходимо вносить изменения в эту функцию. Для исследования влияния параметров на движение системы удобнее параметры системы задавать вне тела функции правых частей. Для передачи  параметров в функцию правых частей можно использовать объект типа <a href="https://habrahabr.ru/post/330034/">namedtuple</a> из модуля <a href="https://docs.python.org/3/library/collections.html#collections.namedtuple">collections</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="c1"># Создаем структуру данных 
</span><span class="n">Parameters</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">'Parameters'</span><span class="p">,</span> <span class="s">'g, m, w, c, L0, R, f'</span><span class="p">)</span>

<span class="c1"># Создаем набор параметров
</span><span class="n">p1</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="mf">9.81</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mf">0.025</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
<span class="c1"># или так
</span><span class="n">p1</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">L0</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># Ещё один набор параметров (с другой жёсткостью пружины)
</span><span class="n">p2</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">L0</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></div>

<p>Следует отметить, что как и классический tuple (кортеж), именованный кортеж не изменяем, т.е. после создания нельзя изменить значение атрибута, это приведет к ошибке.</p>

<p>Перепишем функцию правых частей дифференциальных уравнений, добавив третий аргумент функции – структуру с параметрами системы</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dqdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="c1"># Функция правых частей
</span>    <span class="c1"># t - текущее время
</span>    <span class="c1"># q - вектор состояния системы
</span>    <span class="c1"># p - параметры системы
</span>    <span class="c1"># для системы с одной степенью свободы это координата шарика и его скорость
</span>    <span class="n">x</span>  <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Для удобства все параметры извлекаем из именованного кортежа в отдельные переменные
</span>    <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">t</span>    <span class="c1"># Угол поворота     
</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">vx</span><span class="o">-</span><span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">-</span><span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">R</span><span class="p">)</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">N</span>  <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ny</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Nz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>     
    <span class="c1"># Вычисляем ускорение шарика
</span>    <span class="n">ax</span>  <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">c</span><span class="o">/</span><span class="n">m</span> <span class="o">-</span> <span class="n">f</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="n">m</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">L0</span><span class="o">+</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">R</span><span class="p">)</span>
   
    <span class="c1"># q содержит координату и скорость,
</span>    <span class="c1"># возвращаем производную от q - скорость и ускорение    
</span>    <span class="k">return</span> <span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</code></pre></div></div>

<p>Поскольку функция численного интегрирования solve_ivp первым аргументом ожидает функцию с двумя параметрами, используем лямбда-функцию двух аргументов, которая будет вызывать новую функцию правых частей с тремя аргументами, передавая в неё структуру с параметрами системы:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sol1</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">dqdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p1</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">)</span>
</code></pre></div></div>

<p>Решение для второго набора параметров</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sol2</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">dqdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">)</span>
</code></pre></div></div>

<p>Сравним два решения:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol1</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol1</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">'k-'</span><span class="p">,</span> <span class="n">sol2</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol2</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">'k--'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">([</span><span class="s">'c=100 Н/м'</span><span class="p">,</span><span class="s">'c=200 Н/м'</span><span class="p">]);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'x, м'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Влияние жёсткости пружины'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="определение-силы-реакции-при-движении-шарика-в-канале">Определение силы реакции при движении шарика в канале</h3>

<h4 id="вариант-1">Вариант 1.</h4>

<p>Создадим функцию, которая будет вычислять реакцию заданного вектора состояния q и параметров p:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">Ny</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="c1"># t - время
</span>    <span class="c1"># q - массив из двух элементов (x, Vx)
</span>    <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">R</span>
</code></pre></div></div>

<p>Склеиваем таблицу времени (строку 1xN) с таблицей решения (матрица 2xN), транспонируем результат. В результате этих действий получим матрицу Nx3, каждая строка которой содержит решение для заданного момента времени:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># t0 x(t0) vx(t0)
# t1 x(t1) vx(t1)
# t2 x(t2) vx(t2)
# ...
# tN x(tN) vx(tN)
</span><span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sol1</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol1</span><span class="p">.</span><span class="n">y</span><span class="p">)).</span><span class="n">T</span>
</code></pre></div></div>

<p>Вызываем функцию  Ny(t, q, p) для каждой строки полученной матрицы:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sol1_Ny</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">Ny</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">p1</span><span class="p">),</span> <span class="n">data1</span> <span class="p">))</span>
</code></pre></div></div>

<p>Для второго набора параметров</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sol2</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol2</span><span class="p">.</span><span class="n">y</span><span class="p">)).</span><span class="n">T</span><span class="p">;</span>
<span class="n">sol2_Ny</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">Ny</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">p2</span><span class="p">),</span> <span class="n">data2</span> <span class="p">))</span>
</code></pre></div></div>

<p>Построим графики сил реакции \(N_y\) для двух наборов параметров</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol1</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol1_Ny</span><span class="p">,</span><span class="s">'r-'</span><span class="p">,</span><span class="n">sol2</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol2_Ny</span><span class="p">,</span><span class="s">'b-.'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'$N_y$, Н'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">([</span><span class="s">'c=100 Н/м'</span><span class="p">,</span><span class="s">'c=200 Н/м'</span><span class="p">]);</span>
</code></pre></div></div>

<h4 id="вариант-2">Вариант 2.</h4>

<p>Функция, которую можно вызвать сразу для всех значений таблицы решения.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">Ny</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="c1"># t - массив t0, t1, t2, ... tN
</span>    <span class="c1"># q - массив [ [ x(t0), x(t1), x(t2), ..., x(tN) ], [ vx(t0), vx(t1), ..., vx(tN) ] ]    
</span>    <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol1</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">Ny</span><span class="p">(</span><span class="n">sol1</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p1</span><span class="p">),</span> <span class="n">sol2</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">Ny</span><span class="p">(</span><span class="n">sol2</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol2</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p2</span><span class="p">));</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'$N_y$, Н'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">([</span><span class="s">'c=100 Н/м'</span><span class="p">,</span><span class="s">'c=200 Н/м'</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s">'lower right'</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/img/blog/two-dof-mech-python-c-effect.png" alt="model.png" />
​</p>
<h3 id="аппроксимация-функции-sign-гладкой-функцией">Аппроксимация функции sign гладкой функцией</h3>

<p>Численные методы интегрирования дифференциальных уравнений обычно предполагают гладкость функции правых частей \(f(t,q)\) по своим аргументам. Аппроксимируем функцию sign, которая использовалась для определения направления действия силы трения, гладкой функцией на основе <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%B8%D0%B3%D0%BC%D0%BE%D0%B8%D0%B4%D0%B0">сигмоиды</a></p>

\[S(x) = \frac{1}{1+e^{-x}}\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s">'r-'</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s">'k--'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'x'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">([</span><span class="s">'S(x)'</span><span class="p">,</span><span class="s">'sign(x)'</span><span class="p">]);</span>
</code></pre></div></div>

<p>“Крутизной” сигмоиды можно управлять при помощи параметра-множителя k перед аргументом x</p>

\[S(x) = 2 \left( \frac{1}{1+e^{-k x}} - \frac{1}{2} \right)\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span> <span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.005</span><span class="p">,</span><span class="mf">0.005</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span><span class="n">x</span><span class="p">,</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2000</span><span class="p">),</span><span class="n">x</span><span class="p">,</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s">'k--'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">([</span><span class="s">'k=10 000'</span><span class="p">,</span><span class="s">'k=2 000'</span><span class="p">,</span><span class="s">'k=1 000'</span><span class="p">,</span><span class="s">'sign(x)'</span><span class="p">]);</span>
</code></pre></div></div>

<p><img src="/assets/img/blog/two-dof-mech-python-sigmoid.png" alt="" /></p>

<p>Перепишем функцию правых частей:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dqdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="c1"># Функция правых частей
</span>    <span class="c1"># t - текущее время
</span>    <span class="c1"># q - вектор состояния системы
</span>    <span class="c1"># p - параметры системы
</span>    <span class="c1"># для системы с одной степенью свободы это координата шарика и его скорость
</span>    <span class="n">x</span>  <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Для удобства все параметры извлекаем из именованного кортежа в отдельные переменные
</span>    <span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">t</span>    <span class="c1"># Угол поворота     
</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">vx</span><span class="o">-</span><span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">-</span><span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">R</span><span class="p">)</span>
    <span class="n">Nz</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">N</span>  <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ny</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Nz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>     
    <span class="c1"># Вычисляем ускорение шарика
</span>    <span class="n">ax</span>  <span class="o">=</span> <span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">c</span><span class="o">/</span><span class="n">m</span> <span class="o">-</span> <span class="n">f</span><span class="o">*</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="n">m</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">L0</span><span class="o">+</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">R</span><span class="p">)</span>
   
    <span class="c1"># q содержит координату и скорость,
</span>    <span class="c1"># возвращаем производную от q - скорость и ускорение    
</span>    <span class="k">return</span> <span class="p">(</span><span class="n">vx</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</code></pre></div></div>

<p>Решение и графики</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p1</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">L0</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">dqdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p1</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">'BDF'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">'k-'</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">'k--'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'x, м, $V_x$, м/c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">((</span><span class="s">'x'</span><span class="p">,</span><span class="s">'$V_x$'</span><span class="p">));</span>
</code></pre></div></div>
<p>​</p>
<h2 id="система-с-двумя-степенями-свободы">Система с двумя степенями свободы</h2>

<p>Во втором рассматриваемом случае механическая системы имеет две степени свободы, при этом движение происходит под действием только потенциальных сил – силы упругости пружины и силы тяжести. Трение при движении шарика внутри канала и при вращении пластины вокруг оси \(O_1\) не учитывается.</p>

<p><img src="/assets/img/blog/two-dof-mech-python-2.png" alt="model.png" /></p>

<p>Уравнения движения запишем в форме уравнений Лагранжа второго рода для угла поворота пластины и координаты шарика относительно пластины:</p>

\[\begin{aligned}
    &amp; \frac{d}{dt} \frac{\partial T}{\partial \dot \varphi} - \frac{\partial T}{\partial \varphi} = - \frac{\partial \Pi}{\partial \varphi} \\
    &amp; \frac{d}{dt} \frac{\partial T}{\partial \dot x} - \frac{\partial T}{\partial x} = - \frac{\partial \Pi}{\partial x}
\end{aligned}\]

<p>Кинетическая энергия системы имеет вид:</p>

\[T = \frac{1}{2} m_2\left(\dot{\varphi}^2 \left(l_0-\frac{\sqrt{3} R}{2}+x\right)^2+\left(\dot x - R \dot{\varphi}\right)^2\right)+\frac{3}{8} m_1 R^2 \dot{\varphi}^2\]

<p>Потенциальная энергия системы:</p>

\[\Pi = \frac{1}{2} \left(c x^2+g m_2 \sin \varphi \left(-2 l_0 + \sqrt{3} R - 2 x\right) - g R (m_1+2 m_2) \cos \varphi\right)\]

<p>Уравнения движения:</p>

\[\left\{
\begin{align}
&amp; \left[ m_2 \left(l_0-\frac{\sqrt{3} R}{2}+x\right)^2+\frac{3 m_1 R^2}{4}+m_2 R^2 \right] \cdot \ddot{\varphi} - m_2 R \cdot \ddot x =  \frac{1}{2} \left(g m_2 \cos \varphi \left(2 l_0-\sqrt{3} R+2 x\right)-g R (m_1+2 m_2) \sin \varphi \right) - 2 m_2 \dot{\varphi} \dot{x} \left(l_0-\frac{\sqrt{3} R}{2}+x\right) \\
&amp; -m_2 R \cdot \ddot \varphi + m_2 \cdot \ddot x = - c x + m_2 g \sin \varphi + m_2 \left( l_0 - \frac{\sqrt{3}}{2}R + x \right) \dot{\varphi}^2
\end{align}
\right.\]

<p>Полученную систему дифференциальных уравнений можно записать в матричной форме</p>

\[\left\{
\begin{aligned}
&amp; a_{11} \cdot \ddot \varphi + a_{12} \cdot \ddot x = b_1 \\
&amp; a_{21} \cdot \ddot \varphi + a_{22} \cdot \ddot x = b_2
\end{aligned}
\right.\]

<p>или</p>

\[\begin{bmatrix} a_{11} &amp; a_{12}  \\ a_{21} &amp; a_{22} \end{bmatrix} \cdot \begin{bmatrix} \ddot \varphi \\ \ddot x \end{bmatrix} = \begin{bmatrix} b_{1} \\ b_{2} \end{bmatrix}\]

<p>где</p>

\[\begin{aligned}
&amp; a_{11} = \left[ m_2 \left(l_0-\frac{\sqrt{3} R}{2}+x\right)^2+\frac{3 m_1 R^2}{4}+m_2 R^2 \right], \quad a_{12} = - m_2 R \\
&amp; a_{21} = -m_2 R, \quad a_{22} = m_2 \\
&amp; b_1 = \frac{1}{2} \left(g m_2 \cos \varphi \left(2 l_0-\sqrt{3} R+2 x\right)-g R (m_1+2 m_2) \sin \varphi \right) - 2 m_2 \dot{\varphi} \dot{x} \left(l_0-\frac{\sqrt{3} R}{2}+x\right) \\
&amp; b_2 = - c x + m_2 g \sin \varphi + m_2 \left( l_0 - \frac{\sqrt{3}}{2}R + x \right) \dot{\varphi}^2
\end{aligned}\]

<p>Дифференциальные уравнения движения системы записаны в форме системы линейных уравнений относительно ускорений. Это систему можно решить аналитически и привести систему уравнений к форме Коши. Однако, для системы с большим числом степеней свободы, аналитическое решение и приведение системы к форме Коши будет громоздким, поэтому удобнее решение системы линейных уравнений проводить численно в функции правых частей.</p>

<h3 id="параметры-системы">Параметры системы</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Создаем структуру данных 
</span><span class="n">Parameters</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">'Parameters'</span><span class="p">,</span> <span class="s">'g, m1, m2, c, L0, R'</span><span class="p">)</span>

<span class="c1"># Создаем набор параметров
</span><span class="n">p</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">m1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">m2</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">L0</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="функция-правых-частей-1">Функция правых частей</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dqdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="c1"># Функция правых частей
</span>    <span class="c1"># t - текущее время
</span>    <span class="c1"># q - вектор состояния системы
</span>    <span class="c1"># p - параметры системы
</span>    <span class="c1"># для системы с одной степенью свободы это координата шарика и его скорость    
</span>    <span class="n">phi</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">w</span>   <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span>   <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">vx</span>  <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    
    <span class="c1"># Для удобства все параметры извлекаем из именованного кортежа в отдельные переменные
</span>    <span class="n">g</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    <span class="c1"># Коэффициенты при ускорения в системе линейных уравнений
</span>    <span class="c1"># относительно производных
</span>    <span class="n">a11</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">m1</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="n">m2</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">R</span> <span class="o">+</span> <span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="n">L0</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">a12</span> <span class="o">=</span> <span class="o">-</span><span class="n">m2</span><span class="o">*</span><span class="n">R</span>
    
    <span class="n">a21</span> <span class="o">=</span> <span class="o">-</span><span class="n">m2</span><span class="o">*</span><span class="n">R</span>
    <span class="n">a22</span> <span class="o">=</span>  <span class="n">m2</span>
    
    <span class="c1"># Элементы матрицы правых частей
</span>    <span class="n">b1</span>  <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="p">(</span> <span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">L0</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">m2</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="n">L0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">R</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">vx</span><span class="o">*</span><span class="n">w</span>
    <span class="n">b2</span>  <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="n">L0</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">w</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">m2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    
    <span class="c1"># Составляем матрицы системы линейный уравнений относительно вторых производных
</span>    <span class="n">A</span>   <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">],</span> <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">]]</span> <span class="p">)</span>
    <span class="n">B</span>   <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">])</span>

    <span class="c1"># Решаем систему линейных уравнений
</span>    <span class="n">d2q</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>   
    
    <span class="c1"># Получаем угловое ускорение 
</span>    <span class="n">d2phi</span> <span class="o">=</span> <span class="n">d2q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># и линейное относительное ускорение шарика
</span>    <span class="n">d2x</span>   <span class="o">=</span> <span class="n">d2q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># q содержит координату и скорость,
</span>    <span class="c1"># возвращаем производную от q - скорость и ускорение    
</span>    <span class="k">return</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">d2phi</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">d2x</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="начальные-условия">Начальные условия</h3>

\[\varphi(0) = 0.2, \quad x(0) = 0, \quad \dot{\varphi}(0) = 0.02, \quad \dot{x}(0) = 0.\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">q0</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="интегрирование-1">Интегрирование</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">dqdt</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">q0</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">)</span>
</code></pre></div></div>

<p>График изменения угла поворота пластины</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">'k-'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'$</span><span class="se">\\</span><span class="s">varphi$, рад'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">'dotted'</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/img/blog/two-dof-mech-python-phi.png" alt="" /></p>

<p>График перемещения шарика</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">'k-'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'$x$, м'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">'dotted'</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/img/blog/two-dof-mech-python-x.png" alt="" /></p>

<p>Проверим корректность построенной модели. Рассматриваемая механическая система с двумя степенями свободы является консервативной: при движении этой системы сумма её потенциальной П и кинетической Т энергий не изменяется.</p>

<h3 id="функция-вычисления-кинетической-энергии-системы">Функция вычисления кинетической энергии системы</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">kinetic_energy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">w</span>   <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span>   <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">vx</span>  <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>    
    
    <span class="n">g</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">8.0</span><span class="p">)</span><span class="o">*</span><span class="n">m1</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="n">L0</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">vx</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">w</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">T</span>
</code></pre></div></div>

<p>График изменения кинетической энергии</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">kinetic_energy</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> <span class="s">'k-'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'T, Дж'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">'dotted'</span><span class="p">);</span>
</code></pre></div></div>
<p>​</p>
<h3 id="функция-вычисления-потенциальной-энергии-системы">Функция вычисления потенциальной энергии системы</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">potential_energy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">w</span>   <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span>   <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">vx</span>  <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>    
    
    <span class="n">g</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">P</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">c</span> <span class="o">+</span> <span class="n">m2</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">L0</span><span class="o">+</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">g</span><span class="o">*</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">m2</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">P</span>
</code></pre></div></div>

<p>График изменения потенциальной энергии</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">potential_energy</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> <span class="s">'k-'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'П, Дж'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">'dotted'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="полная-энергия">Полная энергия</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">E</span> <span class="o">=</span> <span class="n">kinetic_energy</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">potential_energy</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">kinetic_energy</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> <span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">potential_energy</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">),</span> <span class="n">sol</span><span class="p">.</span><span class="n">t</span><span class="p">,</span> <span class="n">E</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">'dotted'</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'t, c'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Энергия, Дж'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">([</span><span class="s">'T'</span><span class="p">,</span><span class="s">'П'</span><span class="p">,</span><span class="s">'T+П'</span><span class="p">]);</span>
</code></pre></div></div>

<p><img src="/assets/img/blog/two-dof-mech-python-TPE.png" alt="" /></p>

<p>График иллюстрирует сохранение полной энергии системы, что свидетельствует о корректности построенной модели механической системы с двумя степенями свободны.</p>]]></content><author><name></name></author><category term="mechanics" /><category term="cae" /><summary type="html"><![CDATA[Пример интегрирования в среде Python уравнений движения механической системы с двумя степенями свободы на примере курсовой работы "Исследование движения точки и механической системы" курса теоретической механики Самарского университета]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://classmech.github.io/assets/img/blog/two-dof-mech-python.png" /><media:content medium="image" url="https://classmech.github.io/assets/img/blog/two-dof-mech-python.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>